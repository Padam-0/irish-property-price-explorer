{% extends 'homepage/header.html' %}

{% block content %}

    {% load staticfiles %}
    <link href="{% static 'reporter/css/index-style.css' %}" rel="stylesheet">
    <link href="{% static 'reporter/css/seg-control.css' %}" rel="stylesheet">
    <link href="{% static 'homepage/css/more-style.css' %}" rel="stylesheet">
    <script src="{% static 'reporter/js/index.js' %}"></script>
    <script src="{% static 'reporter/js/natave.js' %}"></script>
    <script src="{% static 'reporter/js/sales_natave.js' %}"></script>
    <script src="{% static 'reporter/js/sales_natave_nbd.js' %}"></script>
    <script src="{% static 'riskdb/js/d3-legend.min.js' %}"></script>
    <script src="{% static 'reporter/js/d3-textwrap.min.js' %}"></script>
    <div id="reporting">
        <div id="aoi">
            <div id="aoi-title">
                <h3>Area of Interest</h3>
            </div>
            <div id="aoi-stats">
                <div id="aoi-stats-left">
                    <p id="aoi-p">Area of Interest:</p>
                </div>
                <div id="aoi-stats-right">
                </div>
            </div>
            <div id="aoi-map">
                {% include 'reporter/includes/map-snippet.html' %}
                {% block map %}
                {% endblock %}
            </div>

        </div>
        <div id="options">
                <button class="accordion" id="filter-options"><span id="bleft">Change filter options:</span><span id="bright"><i class="fa fa-arrow-circle-right fa-2x" aria-hidden="true"></i></span></button>
                <div class="panel">
                    <div id="search-area">
                        <input id="address" maxlength="100" name="address" placeholder="Search for an address..." type="text">
                        <button type="submit" class="btn btn-default" id="search-submit">Search</button>
                    </div>
                    <div id="map-cont">
                        <div id="map-area"></div>
                        <div id="map-options">
                            <p>Show calculation area on map?</p>
                            <input type='checkbox' title="showonmap" id="showzone"></input>
                        </div>
                    </div>
                    <div id="ag-opt-top">
                        <div id="calc-opt">
                            <p>Calculation Area: </p>
                            <div class="segmented-control" id="sc99">
                                <input type="radio" name="sc-99" id="sc-5-1-1" checked>
                                <input type="radio" name="sc-99" id="sc-5-1-2">
                                <input type="radio" name="sc-99" id="sc-5-1-3">
                                <input type="radio" name="sc-99" id="sc-5-1-4">
                                <input type="radio" name="sc-99" id="sc-5-1-5">

                                <label for="sc-5-1-1" data-value="Map">Map</label>
                                <label for="sc-5-1-2" data-value="Radius">Radius</label>
                                <label for="sc-5-1-3" data-value="County">County</label>
                                <label for="sc-5-1-4" data-value="Region">Region</label>
                                <label for="sc-5-1-5" data-value="Country">Country</label>
                            </div>
                        </div>
                        <div id="dist-opt">
                            <div id="dist-opt-left">
                                <div id="radius">
                                    <p>Radius:</p>
                                    <div>
                                        <input title="radius-selector" id="radius-selector"></input>
                                        <p>km</p>
                                    </div>
                                </div>

                                <div id="region">
                                    <p>Region: </p>
                                    <div>
                                        <datalist id="regions">
                                            <option value="Connacht">Connacht</option>
                                            <option value="Leinster">Leinster</option>
                                            <option value="Munster">Munster</option>
                                            <option value="Ulster">Ulster</option>
                                        </datalist>
                                        <input type="text" list="regions" title="region-selector" id="region-selector" placeholder="Start Typing">
                                    </div>
                                </div>
                                <div id="county">
                                    <p>County: </p>
                                    <div>
                                        <datalist id="counties">
                                            <option value="Carlow">Carlow</option>
                                            <option value="Cavan">Cavan</option>
                                            <option value="Clare">Clare</option>
                                            <option value="Cork">Cork</option>
                                            <option value="Donegal">Donegal</option>
                                            <option value="Dublin">Dublin</option>
                                            <option value="Galway">Galway</option>
                                            <option value="Kerry">Kerry</option>
                                            <option value="Kildare">Kildare</option>
                                            <option value="Kilkenny">Kilkenny</option>
                                            <option value="Laois">Laois</option>
                                            <option value="Leitrim">Leitrim</option>
                                            <option value="Limerick">Limerick</option>
                                            <option value="Longford">Longford</option>
                                            <option value="Louth">Louth</option>
                                            <option value="Mayo">Mayo</option>
                                            <option value="Meath">Meath</option>
                                            <option value="Monaghan">Monaghan</option>
                                            <option value="Offaly">Offaly</option>
                                            <option value="Roscommon">Roscommon</option>
                                            <option value="Sligo">Sligo</option>
                                            <option value="Tipperary">Tipperary</option>
                                            <option value="Waterford">Waterford</option>
                                            <option value="Westmeath">Westmeath</option>
                                            <option value="Wexford">Wexford</option>
                                            <option value="Wicklow">Wicklow</option>
                                        </datalist>
                                        <input type="text" list="counties" title="county-selector" id="county-selector" placeholder="Start Typing">
                                    </div>
                                </div>
                            </div>
                            <div id="dist-opt-right">
                                <p>Remove Unmapped Data?</p>
                                <input type='checkbox' title="showonmap" id="bad_data"></input>
                            </div>
                        </div>
                        <div id="sliders">
                            <div id="tSlider"></div>
                            <div class="slide">
                                <div class="slide-label">
                                    <p>Start Date: </p>
                                    <p id="t-value-lower"></p>
                                </div>
                                <div class="slide-label">
                                    <p>End Date: </p>
                                    <p id="t-value-upper"></p>
                                </div>
                            </div>
                            <div id="pSlider"></div>
                            <div class="slide">
                                <div class="slide-label">
                                    <p>Minimum Price: </p>
                                    <p id="p-value-lower"></p>
                                </div>
                                <div class="slide-label">
                                    <p>Maximum Price: </p>
                                    <p id="p-value-upper"></p>
                                </div>
                            </div>
                        </div>
                        <div id="recalc">
                            <button class="btn btn-default" id="rec-button">Change Filter Options</button>
                        </div>
                    </div>
                </div>
            </div>
        <hr>
        {% if enoughdata == 'true' %}
        <div id="sales">
            <div id="sales-title">
                <h3>Area Property Sales</h3>
            </div>
            <div id="sales-stats">
                <div id="sales-stats-left">
                    <p>Average Price:</p>
                    <p>Median Price:</p>
                    <p>Property Sales:</p>
                    <p>Maximum Sale Price:</p>
                    <p>Minimum Sale Price:</p>
                </div>
                <div id="sales-stats-right">

                </div>
            </div>
            <div id="sales-graphs">
                <div class="sales-chart-row">
                    <div class="s-chart" id="s-one-cont">
                        <svg id="chart-s-one" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="s-seg-controls">
                        <div class="s-seg-control-cont seg-control-left">
                            <p>Time:</p>
                            <div class="segmented-control" id="scS1">
                                <input type="radio" name="sc-S1" id="sc-7-1-1">
                                <input type="radio" name="sc-S1" id="sc-7-1-2">
                                <input type="radio" name="sc-S1" id="sc-7-1-3">
                                <input type="radio" name="sc-S1" id="sc-7-1-4">
                                <input type="radio" name="sc-S1" id="sc-7-1-5">
                                <input type="radio" name="sc-S1" id="sc-7-1-6">
                                <input type="radio" name="sc-S1" id="sc-7-1-7" checked>

                                <label for="sc-7-1-1" data-value="1 Month">1 Month</label>
                                <label for="sc-7-1-2" data-value="3 Months">3 Months</label>
                                <label for="sc-7-1-3" data-value="6 Months">6 Months</label>
                                <label for="sc-7-1-4" data-value="1 Year">1 Year</label>
                                <label for="sc-7-1-5" data-value="2 Years">2 Years</label>
                                <label for="sc-7-1-6" data-value="5 Years">5 Years</label>
                                <label for="sc-7-1-7" data-value="All">All</label>
                            </div>
                        </div>
                        <div class="s-seg-control-cont seg-control-right">
                            <p>Aggregation Period:</p>
                            <div class="segmented-control" id="scS11">
                                <input type="radio" name="sc-S11" id="sc-3-11-1">
                                <input type="radio" name="sc-S11" id="sc-3-11-2" checked>
                                <input type="radio" name="sc-S11" id="sc-3-11-3">

                                <label for="sc-3-11-1" data-value="Daily">Daily</label>
                                <label for="sc-3-11-2" data-value="Weekly">Weekly</label>
                                <label for="sc-3-11-3" data-value="Monthly">Monthly</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small-sales">
                <div class="sales-chart-row">
                    <div class="s-chart" id="s-two-cont">
                        <svg id="chart-s-two" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="s-seg-controls">
                        <div class="s-seg-control-cont seg-control-left">
                            <p>Time:</p>
                            <div class="segmented-control" id="scS2">
                                <input type="radio" name="sc-S2" id="sc-7-2-1">
                                <input type="radio" name="sc-S2" id="sc-7-2-2">
                                <input type="radio" name="sc-S2" id="sc-7-2-3">
                                <input type="radio" name="sc-S2" id="sc-7-2-4">
                                <input type="radio" name="sc-S2" id="sc-7-2-5">
                                <input type="radio" name="sc-S2" id="sc-7-2-6">
                                <input type="radio" name="sc-S2" id="sc-7-2-7" checked>

                                <label for="sc-7-2-1" data-value="1 Month">1 Month</label>
                                <label for="sc-7-2-2" data-value="3 Months">3 Months</label>
                                <label for="sc-7-2-3" data-value="6 Months">6 Months</label>
                                <label for="sc-7-2-4" data-value="1 Year">1 Year</label>
                                <label for="sc-7-2-5" data-value="2 Years">2 Years</label>
                                <label for="sc-7-2-6" data-value="5 Years">5 Years</label>
                                <label for="sc-7-2-7" data-value="All">All</label>
                            </div>
                        </div>
                        <div class="s-seg-control-cont seg-control-right">
                            <p>Aggregation Period:</p>
                            <div class="segmented-control" id="scS21">
                                <input type="radio" name="sc-S21" id="sc-3-21-1">
                                <input type="radio" name="sc-S21" id="sc-3-21-2" checked>
                                <input type="radio" name="sc-S21" id="sc-3-21-3">

                                <label for="sc-3-21-1" data-value="Daily">Daily</label>
                                <label for="sc-3-21-2" data-value="Weekly">Weekly</label>
                                <label for="sc-3-21-3" data-value="Monthly">Monthly</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small-sales">
                <div class="sales-chart-row">
                    <div class="s-chart" id="s-three-cont">
                        <svg id="chart-s-three" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="s-seg-controls">
                        <div class="s-seg-control-cont seg-control-left">
                            <p>Time:</p>
                            <div class="segmented-control" id="scS3">
                                <input type="radio" name="sc-S3" id="sc-7-3-1">
                                <input type="radio" name="sc-S3" id="sc-7-3-2">
                                <input type="radio" name="sc-S3" id="sc-7-3-3">
                                <input type="radio" name="sc-S3" id="sc-7-3-4">
                                <input type="radio" name="sc-S3" id="sc-7-3-5">
                                <input type="radio" name="sc-S3" id="sc-7-3-6">
                                <input type="radio" name="sc-S3" id="sc-7-3-7" checked>

                                <label for="sc-7-3-1" data-value="1 Month">1 Month</label>
                                <label for="sc-7-3-2" data-value="3 Months">3 Months</label>
                                <label for="sc-7-3-3" data-value="6 Months">6 Months</label>
                                <label for="sc-7-3-4" data-value="1 Year">1 Year</label>
                                <label for="sc-7-3-5" data-value="2 Years">2 Years</label>
                                <label for="sc-7-3-6" data-value="5 Years">5 Years</label>
                                <label for="sc-7-3-7" data-value="All">All</label>
                            </div>
                        </div>
                        <div class="s-seg-control-cont seg-control-right">
                            <p>Aggregation Period:</p>
                            <div class="segmented-control" id="scS31">
                                <input type="radio" name="sc-S31" id="sc-3-31-1">
                                <input type="radio" name="sc-S31" id="sc-3-31-2" checked>
                                <input type="radio" name="sc-S31" id="sc-3-31-3">

                                <label for="sc-3-31-1" data-value="Daily">Daily</label>
                                <label for="sc-3-31-2" data-value="Weekly">Weekly</label>
                                <label for="sc-3-31-3" data-value="Monthly">Monthly</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small-sales">
                <div class="sales-chart-row">
                    <div class="s-chart" id="s-four-cont">
                        <svg id="chart-s-four" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="s-seg-controls s-seg-hist">
                        <div class="s-seg-control-cont seg-control-left">
                            <p>Time:</p>
                            <div class="segmented-control" id="scS4">
                                <input type="radio" name="sc-S4" id="sc-7-4-1">
                                <input type="radio" name="sc-S4" id="sc-7-4-2">
                                <input type="radio" name="sc-S4" id="sc-7-4-3">
                                <input type="radio" name="sc-S4" id="sc-7-4-4">
                                <input type="radio" name="sc-S4" id="sc-7-4-5">
                                <input type="radio" name="sc-S4" id="sc-7-4-6">
                                <input type="radio" name="sc-S4" id="sc-7-4-7" checked>

                                <label for="sc-7-4-1" data-value="1 Month">1 Month</label>
                                <label for="sc-7-4-2" data-value="3 Months">3 Months</label>
                                <label for="sc-7-4-3" data-value="6 Months">6 Months</label>
                                <label for="sc-7-4-4" data-value="1 Year">1 Year</label>
                                <label for="sc-7-4-5" data-value="2 Years">2 Years</label>
                                <label for="sc-7-4-6" data-value="5 Years">5 Years</label>
                                <label for="sc-7-4-7" data-value="All">All</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr>
        <div id="demographics">
            <div id="demo-title">
                <h3>Area Demographics</h3>
            </div>
            <div id="demo-graphs">
                <div class="chart-row">
                    <div class="chart" id="one-cont">
                        <svg id="chart-one" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc0">
                                <input type="radio" name="sc-0" id="sc-3-1-1" checked>
                                <input type="radio" name="sc-0" id="sc-3-1-2">
                                <input type="radio" name="sc-0" id="sc-3-1-3">
    
                                <label for="sc-3-1-1" data-value="Pie">Pie</label>
                                <label for="sc-3-1-2" data-value="Bar">Bar</label>
                                <label for="sc-3-1-3" data-value="Forest">Forest</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc1">
                                <input type="radio" name="sc-1" id="sc-2-1-1">
                                <input type="radio" name="sc-1" id="sc-2-1-2" checked>

                                <label for="sc-2-1-1" data-value="2011">2011</label>
                                <label for="sc-2-1-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="two-cont">
                        <svg id="chart-two" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc2">
                                <input type="radio" name="sc-2" id="sc-2-2-1" checked>
                                <input type="radio" name="sc-2" id="sc-2-2-2">

                                <label for="sc-2-2-1" data-value="Pie">Pie</label>
                                <label for="sc-2-2-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc21">
                                <input type="radio" name="sc-21" id="sc-2-21-1">
                                <input type="radio" name="sc-21" id="sc-2-21-2" checked>

                                <label for="sc-2-21-1" data-value="2011">2011</label>
                                <label for="sc-2-21-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="three-cont">
                        <svg id="chart-three" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc3">
                                <input type="radio" name="sc-3" id="sc-2-3-1" checked>
                                <input type="radio" name="sc-3" id="sc-2-3-2">

                                <label for="sc-2-3-1" data-value="Pie">Pie</label>
                                <label for="sc-2-3-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc31">
                                <input type="radio" name="sc-31" id="sc-2-31-1">
                                <input type="radio" name="sc-31" id="sc-2-31-2" checked>

                                <label for="sc-2-31-1" data-value="2011">2011</label>
                                <label for="sc-2-31-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="four-cont">
                        <svg id="chart-four" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc4">
                                <input type="radio" name="sc-4" id="sc-2-4-1" checked>
                                <input type="radio" name="sc-4" id="sc-2-4-2">

                                <label for="sc-2-4-1" data-value="Pie">Pie</label>
                                <label for="sc-2-4-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc41">
                                <input type="radio" name="sc-41" id="sc-2-41-1">
                                <input type="radio" name="sc-41" id="sc-2-41-2" checked>

                                <label for="sc-2-41-1" data-value="2011">2011</label>
                                <label for="sc-2-41-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="five-cont">
                        <svg id="chart-five" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc5">
                                <input type="radio" name="sc-5" id="sc-2-5-1" checked>
                                <input type="radio" name="sc-5" id="sc-2-5-2">

                                <label for="sc-2-5-1" data-value="Pie">Pie</label>
                                <label for="sc-2-5-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc51">
                                <input type="radio" name="sc-51" id="sc-2-51-1">
                                <input type="radio" name="sc-51" id="sc-2-51-2" checked>

                                <label for="sc-2-51-1" data-value="2011">2011</label>
                                <label for="sc-2-51-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="six-cont">
                        <svg id="chart-six" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc6">
                                <input type="radio" name="sc-6" id="sc-2-6-1" checked>
                                <input type="radio" name="sc-6" id="sc-2-6-2">

                                <label for="sc-2-6-1" data-value="Pie">Pie</label>
                                <label for="sc-2-6-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc61">
                                <input type="radio" name="sc-61" id="sc-2-61-1">
                                <input type="radio" name="sc-61" id="sc-2-61-2" checked>

                                <label for="sc-2-61-1" data-value="2011">2011</label>
                                <label for="sc-2-61-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="seven-cont">
                        <svg id="chart-seven" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc7">
                                <input type="radio" name="sc-7" id="sc-2-7-1" checked>
                                <input type="radio" name="sc-7" id="sc-2-7-2">

                                <label for="sc-2-7-1" data-value="Pie">Pie</label>
                                <label for="sc-2-7-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc71">
                                <input type="radio" name="sc-71" id="sc-2-71-1">
                                <input type="radio" name="sc-71" id="sc-2-71-2" checked>

                                <label for="sc-2-71-1" data-value="2011">2011</label>
                                <label for="sc-2-71-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="eight-cont">
                        <svg id="chart-eight" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc8">
                                <input type="radio" name="sc-8" id="sc-2-8-1" checked>
                                <input type="radio" name="sc-8" id="sc-2-8-2">

                                <label for="sc-2-8-1" data-value="Pie">Pie</label>
                                <label for="sc-2-8-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc81">
                                <input type="radio" name="sc-81" id="sc-2-81-1">
                                <input type="radio" name="sc-81" id="sc-2-81-2" checked>

                                <label for="sc-2-81-1" data-value="2011">2011</label>
                                <label for="sc-2-81-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="nine-cont">
                        <svg id="chart-nine" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc9">
                                <input type="radio" name="sc-9" id="sc-2-9-1" checked>
                                <input type="radio" name="sc-9" id="sc-2-9-2">

                                <label for="sc-2-9-1" data-value="Pie">Pie</label>
                                <label for="sc-2-9-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc91">
                                <input type="radio" name="sc-91" id="sc-2-91-1">
                                <input type="radio" name="sc-91" id="sc-2-91-2" checked>

                                <label for="sc-2-91-1" data-value="2011">2011</label>
                                <label for="sc-2-91-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="ten-cont">
                        <svg id="chart-ten" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc10">
                                <input type="radio" name="sc-10" id="sc-2-10-1" checked>
                                <input type="radio" name="sc-10" id="sc-2-10-2">

                                <label for="sc-2-10-1" data-value="Pie">Pie</label>
                                <label for="sc-2-10-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc101">
                                <input type="radio" name="sc-101" id="sc-2-101-1">
                                <input type="radio" name="sc-101" id="sc-2-101-2" checked>

                                <label for="sc-2-101-1" data-value="2011">2011</label>
                                <label for="sc-2-101-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="eleven-cont">
                        <svg id="chart-eleven" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc11">
                                <input type="radio" name="sc-11" id="sc-2-11-1" checked>
                                <input type="radio" name="sc-11" id="sc-2-11-2">

                                <label for="sc-2-11-1" data-value="Pie">Pie</label>
                                <label for="sc-2-11-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc111">
                                <input type="radio" name="sc-111" id="sc-2-111-1">
                                <input type="radio" name="sc-111" id="sc-2-111-2" checked>

                                <label for="sc-2-111-1" data-value="2011">2011</label>
                                <label for="sc-2-111-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="twelve-cont">
                        <svg id="chart-twelve" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc12">
                                <input type="radio" name="sc-12" id="sc-2-12-1" checked>
                                <input type="radio" name="sc-12" id="sc-2-12-2">

                                <label for="sc-2-12-1" data-value="Pie">Pie</label>
                                <label for="sc-2-12-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc121">
                                <input type="radio" name="sc-121" id="sc-2-121-1">
                                <input type="radio" name="sc-121" id="sc-2-121-2" checked>

                                <label for="sc-2-121-1" data-value="2011">2011</label>
                                <label for="sc-2-121-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="thirteen-cont">
                        <svg id="chart-thirteen" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc13">
                                <input type="radio" name="sc-13" id="sc-2-13-1" checked>
                                <input type="radio" name="sc-13" id="sc-2-13-2">

                                <label for="sc-2-13-1" data-value="Pie">Pie</label>
                                <label for="sc-2-13-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc131">
                                <input type="radio" name="sc-131" id="sc-2-131-1">
                                <input type="radio" name="sc-131" id="sc-2-131-2" checked>

                                <label for="sc-2-131-1" data-value="2011">2011</label>
                                <label for="sc-2-131-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="fourteen-cont">
                        <svg id="chart-fourteen" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc14">
                                <input type="radio" name="sc-14" id="sc-2-14-1" checked>
                                <input type="radio" name="sc-14" id="sc-2-14-2">

                                <label for="sc-2-14-1" data-value="Pie">Pie</label>
                                <label for="sc-2-14-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc141">
                                <input type="radio" name="sc-141" id="sc-2-141-1">
                                <input type="radio" name="sc-141" id="sc-2-141-2" checked>

                                <label for="sc-2-141-1" data-value="2011">2011</label>
                                <label for="sc-2-141-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="fifteen-cont">
                        <svg id="chart-fifteen" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc15">
                                <input type="radio" name="sc-15" id="sc-2-15-1" checked>
                                <input type="radio" name="sc-15" id="sc-2-15-2">

                                <label for="sc-2-15-1" data-value="Pie">Pie</label>
                                <label for="sc-2-15-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc151">
                                <input type="radio" name="sc-151" id="sc-2-151-1">
                                <input type="radio" name="sc-151" id="sc-2-151-2" checked>

                                <label for="sc-2-151-1" data-value="2011">2011</label>
                                <label for="sc-2-151-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="sixteen-cont">
                        <svg id="chart-sixteen" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc16">
                                <input type="radio" name="sc-16" id="sc-2-16-1" checked>
                                <input type="radio" name="sc-16" id="sc-2-16-2">

                                <label for="sc-2-16-1" data-value="Pie">Pie</label>
                                <label for="sc-2-16-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc161">
                                <input type="radio" name="sc-161" id="sc-2-161-1">
                                <input type="radio" name="sc-161" id="sc-2-161-2" checked>

                                <label for="sc-2-161-1" data-value="2011">2011</label>
                                <label for="sc-2-161-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="seventeen-cont">
                        <svg id="chart-seventeen" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc17">
                                <input type="radio" name="sc-17" id="sc-2-17-1" checked>
                                <input type="radio" name="sc-17" id="sc-2-17-2">

                                <label for="sc-2-17-1" data-value="Pie">Pie</label>
                                <label for="sc-2-17-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc171">
                                <input type="radio" name="sc-171" id="sc-2-171-1">
                                <input type="radio" name="sc-171" id="sc-2-171-2" checked>

                                <label for="sc-2-171-1" data-value="2011">2011</label>
                                <label for="sc-2-171-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="hr-small">
                <div class="chart-row">
                    <div class="chart" id="eighteen-cont">
                        <svg id="chart-eighteen" xmlns="http://www.w3.org/2000/svg"></svg>
                    </div>
                    <div class="seg-controls">
                        <div class="seg-control-cont">
                            <p>Chart Type:</p>
                            <div class="segmented-control" id="sc18">
                                <input type="radio" name="sc-18" id="sc-2-18-1" checked>
                                <input type="radio" name="sc-18" id="sc-2-18-2">

                                <label for="sc-2-18-1" data-value="Pie">Pie</label>
                                <label for="sc-2-18-2" data-value="Bar">Bar</label>
                            </div>
                        </div>
                        <div class="seg-control-cont">
                            <p>Year:</p>
                            <div class="segmented-control" id="sc181">
                                <input type="radio" name="sc-181" id="sc-2-181-1">
                                <input type="radio" name="sc-181" id="sc-2-181-2" checked>

                                <label for="sc-2-181-1" data-value="2011">2011</label>
                                <label for="sc-2-181-2" data-value="2016">2016</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
            <div id='nodata'>
                <p>No results to display.</p>
                <p>Please try different filtering options.</p>
            </div>
        {% endif %}
    </div>

    <script type="text/javascript">
        var width = 649,
            height = 500,
            monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "June",
                "July", "Aug", "Sept", "Oct", "Nov", "Dec"],
            gmap,
            classes = ['slider-color', 'default-color'],
            globalZIndex = 1;

        {% if enoughdata == 'true' %}
            {% autoescape off %}
            age_profile = {{ demo.age_profile }};
            rel_profile = {{ demo.rel_profile }};
            nat_profile = {{ demo.nat_profile }};
            child_profile = {{ demo.child_profile }};
            fam_profile = {{ demo.fam_profile }};
            hh_size_profile = {{ demo.hh_size_profile }};
            house_type_profile = {{ demo.house_type_profile }};
            house_age_profile = {{ demo.house_age_profile }};
            hh_occupancy_profile = {{ demo.hh_occupancy_profile }};
            hh_rooms_profile = {{ demo.hh_rooms_profile }};
            hh_occupation_profile = {{ demo.hh_occupation_profile }};
            prince_stat_profile = {{ demo.prince_stat_profile }};
            socclass_profile = {{ demo.socclass_profile }};
            education_profile = {{ demo.education_profile }};
            transport_method_profile = {{ demo.transport_method_profile }};
            transport_time_profile = {{ demo.transport_time_profile }};
            occupation_profile = {{ demo.occupation_profile }};
            industry_profile = {{ demo.industry_profile }};

            bage_profile = {{ demo.age_profile }};
            brel_profile = {{ demo.rel_profile }};
            bnat_profile = {{ demo.nat_profile }};
            bchild_profile = {{ demo.child_profile }};
            bfam_profile = {{ demo.fam_profile }};
            bhh_size_profile = {{ demo.hh_size_profile }};
            bhouse_type_profile = {{ demo.house_type_profile }};
            bhouse_age_profile = {{ demo.house_age_profile }};
            bhh_occupancy_profile = {{ demo.hh_occupancy_profile }};
            bhh_rooms_profile = {{ demo.hh_rooms_profile }};
            bhh_occupation_profile = {{ demo.hh_occupation_profile }};
            bprince_stat_profile = {{ demo.prince_stat_profile }};
            bsocclass_profile = {{ demo.socclass_profile }};
            beducation_profile = {{ demo.education_profile }};
            btransport_method_profile = {{ demo.transport_method_profile }};
            btransport_time_profile = {{ demo.transport_time_profile }};
            boccupation_profile = {{ demo.occupation_profile }};
            bindustry_profile = {{ demo.industry_profile }};

            age_females = {{ demo.age_females }};
            age_males = {{ demo.age_males }};
            age_na_females = {{ demo.age_na_females }};
            age_na_males = {{ demo.age_na_males }};

            sales_data = {{ sales_data }};
            volume_data = {{ volume_data }};
            new_data = {{ new_data }};
            hist_data = {{ hist_data }};
            price_lobf_coef = {{ price_lobf }};
            vol_lobf_coef = {{ vol_lobf }};
            {% endautoescape %}

            current_points = {{ current_points }};

            var na_volume;
            var na_sales;
            var na_hist_data;

            {% if cache == 'true' %}
                if(Cookies.get('bad_data_inc') == 'true'){
                    na_sales = na_sales_cached;
                    na_volume_raw = na_volume_cached;
                    na_hist_raw = na_hist_cached;
                } else {
                    na_sales = na_sales_nbd_cached;
                    na_volume_raw = na_volume_nbd_cached;
                    na_hist_raw = na_hist_nbd_cached;
                }

                //Now scale na_volume and na_hist
                vol_na_total = 0;
                for (var i = 0; i < na_volume_raw.length; i++){
                    vol_na_total = vol_na_total + na_volume_raw[i][1]
                }
                vol_total = 0;
                for (var j = 0; j < volume_data.length; j++){
                    vol_total = vol_total + volume_data[j][1]
                }
                na_volume = [];
                for (var k = 0; k < na_volume_raw.length; k++){
                    na_volume.push([na_volume_raw[k][0], vol_total * (na_volume_raw[k][1] / vol_na_total) / 4])
                }

                hist_na_total = 0;
                for (var key in na_hist_raw) {
                    hist_na_total = hist_na_total + na_hist_raw[key]
                }
                hist_total = 0;

                for (var key in hist_data) {
                    hist_total = hist_total + hist_data[key]
                }

                na_hist_data = {};
                for (var key in na_hist_raw) {
                    na_hist_data[key] = ((na_hist_raw[key] / hist_na_total) * hist_total)
                }

            {% else %}
                {% autoescape off %}
                    na_sales = {{ na_sales }};
                    na_volume = {{ na_volume }};
                    na_hist_data = {{ na_hist }};

                {% endautoescape %}
            {% endif %}

        {% endif %}

        function getArea(area){
            if (area == 'county') {
                county = document.getElementById("county-selector").value;
                data = getCountyEdges(county);

            } else if (area == 'region') {
                region = document.getElementById("region-selector").value;
                data = getRegionEdges(region);

            } else if (area == 'country') {
                data = "{% static 'homepage/ireland/country.geojson' %}";
            }

            return data;
        }

        function drawMapEdges(map) {

            var rectCoords = [
                {lat: map.getBounds().getSouthWest().lat(), lng: map.getBounds().getNorthEast().lng()},
                {lat: map.getBounds().getSouthWest().lat(), lng: map.getBounds().getSouthWest().lng()},
                {lat: map.getBounds().getNorthEast().lat(), lng: map.getBounds().getSouthWest().lng()},
                {lat: map.getBounds().getNorthEast().lat(), lng: map.getBounds().getNorthEast().lng()},
                {lat: map.getBounds().getSouthWest().lat(), lng: map.getBounds().getNorthEast().lng()}
            ];

            var viewRect = new google.maps.Polygon({
                paths: rectCoords,
                fillOpacity: 0.1,
                strokeColor: 'black',
                strokeOpacity: 0.7,
                strokeWeight: 3
            });

            overlays.push(viewRect);

            viewRect.setMap(map);
        }

        function getCountyEdges(county) {
            return "{% static 'homepage/ireland/counties/' %}" + county +
                ".geojson"
        }

        function getRegionEdges(region) {

            return "{% static 'homepage/ireland/regions/' %}" + region +
                ".geojson"
        }

        function drawRadius(map) {
            radius = document.getElementById("radius-selector").value;

            b = map.getBounds().getSouthWest().lat();
            t = map.getBounds().getNorthEast().lat();
            r = map.getBounds().getNorthEast().lng();
            l = map.getBounds().getSouthWest().lng();

            centroid = {lat: (t - b)/2 + b, lng: (l - r)/ 2 + r};

            var viewCirc = new google.maps.Circle({
                fillOpacity: 0.1,
                strokeColor: 'black',
                strokeOpacity: 0.7,
                strokeWeight: 3,
                map: map,
                center: centroid,
                radius: radius * 1000,
                zIndex: globalZIndex++
            });

            overlays.push(viewCirc);

            viewCirc.setMap(map);
        }

        function drawTimeSlider(){
            var tSlider = document.getElementById('tSlider');

            noUiSlider.create(tSlider, {
                start: [start_date, end_date],
                step: 86400000,
                connect: [false, true, false],
                margin: 604800000,
                behaviour: 'tap',
                range: {
                    'min': [start_date],
                    'max': [end_date]
                }
            });

            var connect = tSlider.querySelectorAll('.noUi-connect');
            var classes = ['slider-color', 'default-color'];

            for ( var i = 0; i < connect.length; i++ ) {
                connect[i].classList.add(classes[i]);
            }

            var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

            var timeValues = [
                document.getElementById('t-value-lower'),
                document.getElementById('t-value-upper')
            ];

            tSlider.noUiSlider.on('update', function( values, handle ) {
                time = new Date(Math.round(values[handle]));

                timeValues[handle].innerHTML = time.getDate() + '-' +
                    monthNames[time.getUTCMonth()] + '-' +
                            String(time.getUTCFullYear()).slice(2);
            });
        }

        function drawPriceSlider(){
            minPrice = 0;
            maxPrice = max_p;

            var pSlider = document.getElementById('pSlider');

            noUiSlider.create(pSlider, {
                start: [minPrice, maxPrice],
                step: 10000,
                connect: [false, true, false],
                margin: 10000,
                behaviour: 'tap',
                range: {
                    'min': [minPrice],
                    'max': [maxPrice]
                }
            });

            var connect = pSlider.querySelectorAll('.noUi-connect');

            for (var i = 0; i < connect.length; i++ ) {
                connect[i].classList.add(classes[i]);
            }

            var priceValues = [
                document.getElementById('p-value-lower'),
                document.getElementById('p-value-upper')
            ];

            pSlider.noUiSlider.on('update', function( values, handle ) {
                val = values[handle];

                priceValues[handle].innerHTML = ' ' + thousandsDisplay(val);
            });
        }

        function initMap() {
            if (document.cookie.indexOf('right') > 0){
                r = parseFloat(Cookies.get('right'));
                l = parseFloat(Cookies.get('left'));
                t = parseFloat(Cookies.get('top'));
                b = parseFloat(Cookies.get('bottom'));

                var center = {lng: (l - r)/2 + r, lat: (t - b)/2 + b};
            }

            gmap = new google.maps.Map(document.getElementById('map-area'), {
                center: center,
                zoom: 13,
                gestureHandling: 'cooperative',
                scrollwheel: false
            });
        }

        function pop_perc(pop, data){
            total = 0;
            for (var i = 0; i < data.length; i ++){
                total += data[i]['value']
            }

            return Math.round(pop / total * 10000) / 100;
        }

        var getAngle = function (d) {
                ang = 180 / Math.PI * (d.startAngle + d.endAngle) / 2 - 90;
                if (ang > 90){
                    ang -= 180
                }
                return ang
            };

        function get_natave(label, cname, year){
            if (year == 2011){
                if (label == 'Other'){
                    switch (cname){
                        case 'twelve':
                            r = natave11['Other']['prince_stat'];
                            break;
                        case 'fifteen':
                            r =  natave11['Other']['transport_method'];
                            break;
                        case 'eighteen':
                            r =  natave11['Other']['ind'];
                            break;
                    }
    
                    return parseInt(r * 10000) / 100 + '%'
                } else if (label == 'Not Stated'){
                    switch (cname){
                        case 'three':
                            r = natave11['Not Stated']['nat'];
                            break;
                        case 'seven':
                            r =  natave11['Not Stated']['house_type'];
                            break;
                        case 'eight':
                            r =  natave11['Not Stated']['house_age'];
                            break;
                        case 'nine':
                            r =  natave11['Not Stated']['hh_occupancy'];
                            break;
                        case 'ten':
                            r =  natave11['Not Stated']['hh_rooms'];
                            break;
                        case 'fourteen':
                            r =  natave11['Not Stated']['education'];
                            break;
                        case 'fifteen':
                            r =  natave11['Not Stated']['transport_method'];
                            break;
                        case 'sixteen':
                            r =  natave11['Not Stated']['transport_time'];
                            break;
                        case 'seventeen':
                            r =  natave11['Not Stated']['occupation'];
                            break;
                    }
    
                    return parseInt(r * 10000) / 100 + '%'
                } else {
                    return parseInt(natave11[label] * 10000) / 100 + '%'
                }
            } else {
                {
                if (label == 'Other'){
                    switch (cname){
                        case 'twelve':
                            r = natave16['Other']['prince_stat'];
                            break;
                        case 'fifteen':
                            r =  natave16['Other']['transport_method'];
                            break;
                        case 'eighteen':
                            r =  natave16['Other']['ind'];
                            break;
                    }
    
                    return parseInt(r * 10000) / 100 + '%'
                } else if (label == 'Not Stated'){
                    switch (cname){
                        case 'three':
                            r = natave16['Not Stated']['nat'];
                            break;
                        case 'seven':
                            r =  natave16['Not Stated']['house_type'];
                            break;
                        case 'eight':
                            r =  natave16['Not Stated']['house_age'];
                            break;
                        case 'nine':
                            r =  natave16['Not Stated']['hh_occupancy'];
                            break;
                        case 'ten':
                            r =  natave16['Not Stated']['hh_rooms'];
                            break;
                        case 'fourteen':
                            r =  natave16['Not Stated']['education'];
                            break;
                        case 'fifteen':
                            r =  natave16['Not Stated']['transport_method'];
                            break;
                        case 'sixteen':
                            r =  natave16['Not Stated']['transport_time'];
                            break;
                        case 'seventeen':
                            r =  natave16['Not Stated']['occupation'];
                            break;
                    }
    
                    return parseInt(r * 10000) / 100 + '%'
                } else {
                    return parseInt(natave16[label] * 10000) / 100 + '%'
                }
            }
            }
        }

        function get_index(name){
            switch (name){
                case 'one':
                    return null;
                    break;
                case 'two':
                    return null;
                    break;
                case 'three':
                    return -1;
                    break;
                case 'four':
                    return null;
                    break;
                case 'five':
                    return null;
                    break;
                case 'six':
                    return null;
                    break;
                case 'seven':
                    return 4;
                    break;
                case 'eight':
                    return 9;
                    break;
                case 'nine':
                    return 6;
                    break;
                case 'ten':
                    return 8;
                    break;
                case 'eleven':
                    return null;
                    break;
                case 'twelve':
                    return 7;
                    break;
                case 'thirteen':
                    return 6;
                    break;
                case 'fourteen':
                    return 11;
                    break;
                case 'fifteen':
                    return 9;
                    break;
                case 'sixteen':
                    return 6;
                    break;
                case 'seventeen':
                    return 9;
                    break;
                case 'eighteen':
                    return 7;
                    break;

            }
        }

        function resized(svg, container){
            var scale = width / container.node().getBoundingClientRect().width;

            // Update SVG height to maintain aspect ratio
            if (height / scale > 580){
                svg.attr("height", 580);
            } else {
                svg.attr("height", height / scale);
            }


            $('.chart-row').css('height', (height / scale ));
            $('.chart').css('height', (height / scale ));

        }

        function wrap(text, width) {
            text.each(function() {
                var text = d3.select(this);

                if (text != null) {
                    var words = text.text().split(/\s+/).reverse(),
                        word,
                        line = [],
                        lineNumber = 0,
                        lineHeight = 1.1, // ems
                        y = text.attr("y"),
                        x = text.attr('x'),
                        dy = parseFloat(text.attr("dy")),
                        dx = parseFloat(text.attr("dx")),
                        tspan = text.text(null).append("tspan")
                            .attr("y", y)
                            .attr("dy", dy + "em");

                    while (word = words.pop()) {
                        line.push(word);
                        tspan.text(line.join(" "));

                        if ((tspan.node().innerHTML.length > 5 && words.length > 0  && line.length > 1) || (tspan.node().innerHTML.length > 10 && line.length > 1)) {
                            line.pop();
                            tspan.text(line.join(" "));
                            line = [word];
                            tspan = text.append("tspan")
                                .attr("x", 0)
                                .attr("y", y)
                                .attr("dy", ++lineNumber * lineHeight + dy + "em")
                                .attr("dx", dx + "em")
                                .text(word);
                        }
                    }
                }
            });
        }

        function drawScatterPlot(data, chart_name, y_axis_label, title, units, label, seq_id, lobf_coef){
            margin = {top: 30, right: 70, bottom: 40, left: 60};

            s_height = height - 250;
            s_width = width;

            var container = d3.select("div#" + chart_name + "-cont")
                .style("width", s_width);

            var svg = d3.select("svg#chart-" + chart_name + "")
                .attr("viewBox", "0 0 " + s_width + " " + s_height);

            window.onresize = function(){
                var scale = s_width / container.node().getBoundingClientRect().width;

                // Update SVG height to maintain aspect ratio
                svg.attr("height", s_height / scale);

                $('.sales-chart-row').css('height', (s_height / scale ));
                $('.s-chart').css('height', (s_height / scale ));
            };

            if (chart_name == 's-one'){
                dat = na_sales;
            } else {
                dat = na_volume
            }

            lobf = [];

            for (var i = 0; i < data.length; i++){
                lobf.push([data[i][0], lobf_coef[0] * Math.pow(data[i][0], 3) + lobf_coef[1] * Math.pow(data[i][0], 2) + data[i][0] * lobf_coef[2] + lobf_coef[3]])
            }

            yMin = 0;

            yMaxA = d3.max(data, function (d) {
                return d[1];
            });

            yMaxB = d3.max(dat, function (d) {
                return d[1];
            });

            if (yMaxB > yMaxA){
                yMax = yMaxB
            } else {
                yMax = yMaxA
            }

            deltaY = yMax * 0.1;

            var yScale = d3.scaleLinear()
                .domain([yMin, yMax + deltaY])
                .range([s_height - margin.bottom, margin.top]);

            var yAxis = d3.axisLeft()
                .scale(yScale)
                .ticks(5)
                .tickFormat(function (d) {
                    var val;
                    if (d >= 1000000) {
                        val = d / 1000000 + ' M'
                    } else if (d == 0) {
                        val = 0
                    } else if (d >= 1000) {
                        val = d / 1000 + ' k'
                    } else {
                        val = d
                    }
                    return units + val
                })
                .tickSizeOuter(0);

            xMin = d3.min(data, function (d) {
                if (d[1] > 0){
                    return d[0];
                }
            });
            xMax = d3.max(data, function (d) {
                if (d[1] > 0){
                    return d[0];
                }
            });

            var xScale = d3.scaleLinear()
                .domain([xMin, xMax])
                .range([margin.left, s_width - margin.right]);

            var xAxis = d3.axisBottom()
                .scale(xScale)
                .tickFormat(function (d) {
                    var dot = new Date(d);
                    return monthNames[dot.getUTCMonth()] + '-' +
                        String(dot.getUTCFullYear()).slice(2);
                });

            div = d3.select("body").append("div")
                        .attr("class", "tooltip")
                        .style("opacity", 0);

            svg.append("defs").append("clipPath")
                .attr("id", "clip")
              .append("rect")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                .attr("width", s_width - margin.left - margin.right)
                .attr("height", s_height - margin.bottom - margin.top);

            var line = d3.line()
                .curve(d3.curveBundle.beta(0.5))
                .x(function(d) { return xScale(d[0]); })
                .y(function(d) { return yScale(d[1]); });

            svg.append("g")
                .attr("class", "clippath")
                .attr("clip-path", "url(#clip)")
                .append("path")
              .datum(dat)
              .attr('class', 'line')
              .attr("fill", "none")
              .attr("stroke", "#008000")
              .attr("stroke-linejoin", "round")
              .attr("stroke-linecap", "round")
              .attr("stroke-width", 2)
              .attr("d", line);

            svg.select(".clippath")
            .append("path")
              .datum(lobf)
              .attr('class', 'lobf')
              .attr("fill", "none")
              .attr("stroke", "#B32650")
              .attr("stroke-linejoin", "round")
              .attr("stroke-linecap", "round")
              .attr("stroke-width", 2)
              .attr("d", line);

            svg.selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) {
                    return xScale(d[0]);
                })
                .attr("cy", function (d) {
                    return yScale(d[1]);
                })
                .attr("r", 2)
                .style("fill", "#05084E")
                .style("opacity", .65)
                .on("mouseover", function(d) {
                    d3.select(this)
                        .style('opacity', 1)
                        .attr('r', 3)
                        .style("fill", "#B32650");
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    t = new Date(d[0]);


                    if ($(this).parent().attr("id") == 'chart-s-one'){
                        if ($("#scS11 input[type='radio']:checked")[0].labels == null){
                            var selector = document.getElementsByName('sc-S11');
                            for(var i = 0; i < selector.length; i++) {
                                //Check if button is checked
                                var button = selector[i];
                                if(button.checked) {
                                    //Return value
                                    id = button.id;
                                }
                            }

                            if (id.slice(id.length - 1) == 1){
                                agg = 'Daily';
                            } else if (id.slice(id.length - 1) == 2){
                                agg = 'Weekly'
                            } else if (id.slice(id.length - 1) == 3){
                                agg = 'Monthly'
                            }

                        } else {
                            // Chrome
                            agg = $("#scS11 input[type='radio']:checked")[0].labels[0].innerHTML;
                        }
                    } else if ($(this).parent().attr("id") == 'chart-s-two') {
                        if ($("#scS21 input[type='radio']:checked")[0].labels == null){
                            var selector = document.getElementsByName('sc-S21');
                            for(var i = 0; i < selector.length; i++) {
                                //Check if button is checked
                                var button = selector[i];
                                if(button.checked) {
                                    //Return value
                                    id = button.id;
                                }
                            }

                            if (id.slice(id.length - 1) == 1){
                                agg = 'Daily';
                            } else if (id.slice(id.length - 1) == 2){
                                agg = 'Weekly'
                            } else if (id.slice(id.length - 1) == 3){
                                agg = 'Monthly'
                            }

                        } else {
                            // Chrome
                            agg = $("#scS21 input[type='radio']:checked")[0].labels[0].innerHTML;
                        }
                    }

                    var tooltip_label;

                    if (agg == 'Weekly'){
                        tooltip_label = 'Week of ' + t.getDate() + '-' +
                        monthNames[t.getUTCMonth()] + "-" +
                        String(t.getUTCFullYear());
                    } else if (agg == 'Daily'){
                        tooltip_label = t.getDate() + '-' +
                        monthNames[t.getUTCMonth()] + "-" +
                        String(t.getUTCFullYear());
                    } else {
                        tooltip_label = monthNames[t.getUTCMonth()] + "-" +
                        String(t.getUTCFullYear());
                    }

                    div.html(tooltip_label + "<br>" + label + thousandsDisplay(d[1]))
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");

                })
                .on("mouseout", function(d) {
                    d3.select(this)
                        .style('opacity', 0.65)
                        .attr('r', 2)
                        .style("fill", "#05084E");
                    div.transition()
                         .duration(500)
                         .style("opacity", 0);
                });

            // Add Title
            svg.append("text")
               .attr("transform", "translate(" + (s_width / 2) + " , 0)")
               .attr("dy", "1em")
               .style("text-anchor", "middle")
               .text(title)
               .style("font-size","1.4em");

            // Add and format X-axis
            svg.append("g")
                .attr("class", "l x axis")
                .attr("transform", "translate(0," + (s_height - margin.bottom) + ")")
                .call(xAxis)
            .selectAll("text")
                .attr("y", 6)
                .attr("x", -3)
                .style("font-size","0.8em")
                .attr("transform", "rotate(45)")
                .style("text-anchor", "start")
                .style("font-family", "Raleway");

            // Add and format X-axis label
            svg.append("text")
               .attr("transform", "translate(" + (s_width - margin.right) + " ," +
                   (s_height) + ")")
               .style("text-anchor", "middle")
               .text("Date of Sale")
               .style("font-size","0.8em");

            // Add and format Y-axis
            svg.append("g")
                .attr("class", "l y axis")
                .attr("transform", "translate(" + margin.left + ",0)")
                .call(yAxis)
            .selectAll("text")
                .style("font-size","0.8em")
                .style("font-family", "Raleway");

            // Add and format Y-axis label
            svg.append("text")
                .attr('class', 'y-axis-label')
                .attr("transform", "rotate(-90)")
                .attr("y", 0)
                .attr("x",0 - (s_height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Average Weekly " + y_axis_label)
                .style("font-size","0.8em");

            var symbolScale =  d3.scaleOrdinal()
              .domain(['National Average', 'Line of Best Fit'])
              .range(['#008000', '#B32650']);

            svg.append("g")
              .attr("class", "legendOrdinal")
              .attr("transform", "translate(" + (s_width - margin.right - 40) + "," + (margin.top) + ")");

            var legendOrdinal = d3.legendColor()
              .shape("path", d3.symbol().type(d3.symbolCircle).size(20)())
              .scale(symbolScale)
              .orient("vertical")
              .shapePadding(2);

            svg.select(".legendOrdinal")
              .call(legendOrdinal);

            svg.selectAll('.swatch')
                .attr("transform", "translate(5, 2)");

            svg.selectAll(".label")
                .style("font-size","0.6em")
                .style('font-weight', 'normal');

            function ajax_get_scat(id, time, agg){
                if (document.getElementById('sc-7-' + id +'-' + 1) == null){
                    cid = id.slice(5,6);
                } else {
                    cid = id
                }

                $.ajax({
                    type: "GET",
                    url: "/reporter/ajax-response-chart/",
                    data: {'chart': 'scatter', 'time': time, 'agg': agg.slice(0, 1), 'chart_id': cid},
                    async: true,
                    dataType: 'json',
                    beforeSend: function () {
                        mid = id.slice(5,6);
                        for (var i = 1; i < 8; i++) {
                            if (document.getElementById('sc-7-' + id +'-' + i) == null){
                                $('#sc-7-' + mid +'-' + i).attr('disabled', true);
                            } else {
                                // Chrome
                                document.getElementById('sc-7-' + id +'-' + i).setAttribute('disabled', true);
                            }
                        }

                        for (var i = 1; i < 4; i++) {
                            if (document.getElementById('sc-3-' + id + "1-" + i) == null){
                                $('#sc-3-' + mid + "1-" + i).attr('disabled', true);
                            } else {
                                // Chrome
                                document.getElementById('sc-3-' + id + "1-" + i).setAttribute('disabled', true);
                            }
                        }
                    },
                    success: function (data) {
                        mid = id.slice(5,6);
                        for (var i = 1; i < 8; i++) {
                            if (document.getElementById('sc-7-' + id +'-' + i) == null){

                                $('#sc-7-' + mid +'-' + i).attr('disabled', false);
                            } else {
                                // Chrome
                                document.getElementById('sc-7-' + id +'-' + i).removeAttribute('disabled');
                            }
                        }
                        for (var i = 1; i < 4; i++) {
                            if (document.getElementById('sc-3-' + id + "1-" + i) == null){

                                $('#sc-3-' + mid + "1-" + i).attr('disabled', false);
                            } else {
                                // Chrome
                                document.getElementById('sc-3-' + id + "1-" + i).removeAttribute('disabled');
                            }
                        }

                        scatter_data = data['scatter_data'];
                        
                        lobf_c = data['lobf_coef'];
                        
                        lobf = [];

                        for (var i = 0; i < scatter_data.length; i++){
                            lobf.push([scatter_data[i][0], lobf_c[0] * Math.pow(scatter_data[i][0], 3) + lobf_c[1] * Math.pow(scatter_data[i][0], 2) + scatter_data[i][0] * lobf_c[2] + lobf_c[3]])
                        }

                        var y_prefix;

                        if (data['agg'] == 'W'){
                            y_prefix = 'Average Weekly ';
                            v_scaler = 1;
                        } else if (data['agg'] == 'D'){
                            y_prefix = 'Average ';
                            v_scaler = 1/7;
                        } else {
                            y_prefix = 'Average Monthly ';
                            v_scaler = 4;
                        }

                        if (chart_name == 's-two'){
                            dat = [];
                            for (var i =0; i < na_volume.length; i++){
                                dat.push([na_volume[i][0], na_volume[i][1] * v_scaler])
                            }
                        } else {
                            dat = na_sales
                        }

                        yMin = 0;

                        yMaxA = d3.max(scatter_data, function (d) {
                            return d[1];
                        });

                        yMaxB = d3.max(dat, function (d) {
                            return d[1];
                        });

                        if (yMaxB > yMaxA){
                            yMax = yMaxB
                        } else {
                            yMax = yMaxA
                        }

                        deltaY = (yMax - yMin) * 0.1;

                        yScale.domain([yMin, yMax + deltaY]);

                        xMin = d3.min(scatter_data, function (d) {
                            return d[0];
                        });
                        xMax = d3.max(scatter_data, function (d) {
                            return d[0];
                        });
                        deltaX = (xMax - xMin) * 0.1;

                        xScale.domain([xMin, xMax + deltaX]);

                        //Update x-axis
                        svg.select(".l.x.axis")
                            .transition()
                            .duration(1000)
                            .call(xAxis);

                        svg.select(".l.x.axis")
                            .selectAll("text")
                            .style("font-size","0.8em")
                            .attr("transform", "rotate(45)")
                            .style("text-anchor", "start")
                            .style("font-family", "Raleway");

                        //Update y-axis
                        svg.select(".l.y.axis")
                            .transition()
                            .duration(1000)
                            .call(yAxis);

                        svg.select('.y-axis-label')
                            .text(y_prefix + y_axis_label);

                        svg.select(".l.y.axis")
                            .selectAll("text")
                            .style("font-size","0.8em")
                            .style("font-family", "Raleway");

                        line.x(function(d) { return xScale(d[0]); })
                            .y(function(d) { return yScale(d[1]); });

                        svg.select(".line")
                          .datum(dat)
                          .transition()
                            .duration(1000)
                            .ease(d3.easeLinear)
                        .attr("d", line);

                        svg.select(".lobf")
                          .datum(lobf)
                          .transition()
                            .duration(1000)
                            .ease(d3.easeLinear)
                        .attr("d", line);

                        var circs = svg.selectAll("circle")
                            .data(scatter_data);

                        circs.transition()
                            .delay(function(d, i) {
                                return i / scatter_data.length * 1000;   // <-- Where the magic happens
                            })
                            .duration(1000)
                            .attr("cx", function (d) {
                                return xScale(d[0]);
                            })
                            .attr("cy", function (d) {
                                return yScale(d[1]);
                            });

                        circs.exit()
                            .transition()
                            .style("opacity", 0)
                            .duration(1000)
                            .remove();

                        var newcircs = svg.selectAll("circle")
                            .data(scatter_data)
                            .enter()
                            .append("circle")
                            .attr("cx", function (d) {
                                return xScale(d[0]);
                            })
                            .attr("cy", function (d) {
                                return yScale(d[1]);
                            })
                            .attr("r", 2)
                            .style("fill", "#05084E")
                            .style('opacity', 0);

                        newcircs.transition()
                            .delay(function(d, i) {
                                return i / scatter_data.length * 1000;
                            })
                            .duration(1000)
                            .style("opacity", .65);


                        newcircs.on("mouseover", function(d) {
                            d3.select(this)
                                .style('opacity', 1)
                                .attr('r', 3)
                                .style("fill", "#B32650");
                            div.transition()
                                .duration(200)
                                .style("opacity", .9);
                            t = new Date(d[0]);

                            var tooltip_label;

                            if (data['agg'] == 'W'){
                                tooltip_label = 'Week of' + t.getDate() + '-' +
                                monthNames[t.getUTCMonth()] + "-" +
                                String(t.getUTCFullYear());
                            } else if (data['agg'] == 'D'){
                                tooltip_label = t.getDate() + '-' +
                                monthNames[t.getUTCMonth()] + "-" +
                                String(t.getUTCFullYear());
                            } else {
                                tooltip_label = monthNames[t.getUTCMonth()] + "-" +
                                String(t.getUTCFullYear());
                            }

                            div.html(tooltip_label +
                                "<br>" + label + thousandsDisplay(d[1]))
                                .style("left", (d3.event.pageX) + "px")
                                .style("top", (d3.event.pageY - 28) + "px");

                        })
                        .on("mouseout", function(d) {
                            d3.select(this)
                                .style('opacity', 0.65)
                                .attr('r', 2)
                                .style("fill", "#05084E");
                            div.transition()
                                 .duration(500)
                                 .style("opacity", 0);
                        });
                    }
                });
            }

            d3.select("#" + seq_id + "-1")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }
            
                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }
            
                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "1 Month", agg)
                });
            d3.select("#" + seq_id + "-2")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "3 Months", agg)
                });
            d3.select("#" + seq_id + "-3")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "6 Months", agg)
                });
            d3.select("#" + seq_id + "-4")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "1 Year", agg)
                });
            d3.select("#" + seq_id + "-5")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "2 Years", agg)
                });
            d3.select("#" + seq_id + "-6")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "5 Years", agg)
                });
            d3.select("#" + seq_id + "-7")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "All", agg)
                });

            d3.select('#' + seq_id.replace("7", "3") + "1-1")
                .on("click", function () {
                    seq_id_3 = seq_id.replace("7", "3");
                    id = seq_id_3.substr(seq_id_3.length - 1);

                    if ($("#scS" + id + " input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1) {
                            agg = '1 Month';
                        } else if (id.slice(id.length - 1) == 2) {
                            agg = '2 Months'
                        } else if (id.slice(id.length - 1) == 3) {
                            agg = '6 Months'
                        } else if (id.slice(id.length - 1) == 4) {
                            agg = '1 Year'
                        } else if (id.slice(id.length - 1) == 5) {
                            agg = '2 Years'
                        } else if (id.slice(id.length - 1) == 6) {
                            agg = '5 Years'
                        } else {
                            agg = 'All'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + " input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, agg, "Daily")
                });
            d3.select('#' + seq_id.replace("7", "3") + "1-2")
                .on("click", function () {
                    seq_id_3 = seq_id.replace("7", "3");
                    id = seq_id_3.substr(seq_id_3.length -1);
                    if ($("#scS" + id + " input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1) {
                            agg = '1 Month';
                        } else if (id.slice(id.length - 1) == 2) {
                            agg = '2 Months'
                        } else if (id.slice(id.length - 1) == 3) {
                            agg = '6 Months'
                        } else if (id.slice(id.length - 1) == 4) {
                            agg = '1 Year'
                        } else if (id.slice(id.length - 1) == 5) {
                            agg = '2 Years'
                        } else if (id.slice(id.length - 1) == 6) {
                            agg = '5 Years'
                        } else {
                            agg = 'All'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + " input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, agg, "Weekly")
                });
            d3.select('#' + seq_id.replace("7", "3") + "1-3")
                .on("click", function () {
                    seq_id_3 = seq_id.replace("7", "3");
                    id = seq_id_3.substr(seq_id_3.length -1);
                    if ($("#scS" + id + " input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1) {
                            agg = '1 Month';
                        } else if (id.slice(id.length - 1) == 2) {
                            agg = '2 Months'
                        } else if (id.slice(id.length - 1) == 3) {
                            agg = '6 Months'
                        } else if (id.slice(id.length - 1) == 4) {
                            agg = '1 Year'
                        } else if (id.slice(id.length - 1) == 5) {
                            agg = '2 Years'
                        } else if (id.slice(id.length - 1) == 6) {
                            agg = '5 Years'
                        } else {
                            agg = 'All'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + " input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, agg, "Monthly")
                });
        }

        function drawScatterSeries(data, chart_name, y_axis_label, title, units, label, seq_id){
            combdata = [];

            for (var i = 0; i < data.length; i++){
                if (data[i][1] > 0){
                    combdata.push([data[i][0], data[i][1], 'used'])
                }
                if (data[i][2] > 0){
                    combdata.push([data[i][0], data[i][2], 'new'])
                }
            }

            margin = {top: 30, right: 70, bottom: 50, left: 60};

            s_height = height - 250;
            s_width = width;

            var container = d3.select("div#" + chart_name + "-cont")
                .style("width", s_width);

            var svg = d3.select("svg#chart-" + chart_name + "")
                .attr("viewBox", "0 0 " + s_width + " " + s_height);

            window.onresize = function(){
                var scale = s_width / container.node().getBoundingClientRect().width;

                // Update SVG height to maintain aspect ratio
                svg.attr("height", s_height / scale);

                $('.sales-chart-row').css('height', (s_height / scale ));
                $('.s-chart').css('height', (s_height / scale ));
            };

            z = d3.scaleOrdinal(['#05084E', '#B32650']);

            yMin = 0;

            yMax = d3.max(combdata, function (d) {
                return d[1]
            });

            deltaY = yMax * 0.1;

            var yScale = d3.scaleLinear()
                .domain([0, yMax + deltaY])
                .range([s_height - margin.bottom, margin.top]);

            var yAxis = d3.axisLeft()
                .scale(yScale)
                .ticks(5)
                .tickFormat(function (d) {
                    var val;
                    if (d >= 1000000) {
                        val = d / 1000000 + ' M'
                    } else if (d == 0) {
                        val = 0
                    } else if (d >= 1000) {
                        val = d / 1000 + ' k'
                    } else {
                        val = d
                    }
                    return units + val
                })
                .tickSizeOuter(0);

            xMin = d3.min(combdata, function (d) {
                return d[0];
            });
            xMax = d3.max(combdata, function (d) {
                return d[0];
            });

            var xScale = d3.scaleLinear()
                .domain([xMin, xMax])
                .range([margin.left, s_width - margin.right]);

            var xAxis = d3.axisBottom()
                .scale(xScale)
                .tickFormat(function (d) {
                    var dot = new Date(d);
                    return monthNames[dot.getUTCMonth()] + '-' +
                        String(dot.getUTCFullYear()).slice(2);
                });

            div = d3.select("body").append("div")
                        .attr("class", "tooltip")
                        .style("opacity", 0);

            svg.selectAll("circle")
                .data(combdata)
                .enter()
                .append("circle")
                .attr("cx", function (d) {
                    return xScale(d[0]);
                })
                .attr("cy", function (d) {
                    return yScale(d[1]);
                })
                .attr("r", 2)
                .style("fill", function(d) {
                  if (d[2] == 'used'){
                      return '#05084E';
                  } else {
                      return '#B32650'
                  }
              })
                .style("opacity", .65)
                .on("mouseover", function(d) {
                d3.select(this)
                    .style('opacity', 1)
                    .attr('r', 3);

                div.transition()
                    .duration(200)
                    .style("opacity", .9);
                t = new Date(d[0]);

                if ($("#scS31 input[type='radio']:checked")[0].labels == null){
                    var selector = document.getElementsByName('sc-S31');
                    for(var i = 0; i < selector.length; i++) {
                        //Check if button is checked
                        var button = selector[i];
                        if(button.checked) {
                            //Return value
                            id = button.id;
                        }
                    }

                    if (id.slice(id.length - 1) == 1){
                        agg = 'Daily';
                    } else if (id.slice(id.length - 1) == 2){
                        agg = 'Weekly'
                    } else if (id.slice(id.length - 1) == 3){
                        agg = 'Monthly'
                    }

                } else {
                    // Chrome
                    agg = $("#scS31 input[type='radio']:checked")[0].labels[0].innerHTML;
                }

                var tooltip_label;

                if (agg == 'Weekly'){
                    tooltip_label = 'Week of ' + t.getDate() + '-' +
                    monthNames[t.getUTCMonth()] + "-" +
                    String(t.getUTCFullYear());
                } else if (agg == 'Daily'){
                    tooltip_label = t.getDate() + '-' +
                    monthNames[t.getUTCMonth()] + "-" +
                    String(t.getUTCFullYear());
                } else {
                    tooltip_label = monthNames[t.getUTCMonth()] + "-" +
                    String(t.getUTCFullYear());
                }

                if (d[2] === "used"){
                    tooltip_label = "2nd Hand Properties<br/>" + tooltip_label
                } else {
                    tooltip_label = "New Properties<br/>" + tooltip_label
                }

                div.html(tooltip_label + "<br>" + label + thousandsDisplay(d[1]))
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px");

                })
                .on("mouseout", function(d) {
                    d3.select(this)
                        .style('opacity', 0.65)
                        .attr('r', 2);
                    div.transition()
                         .duration(500)
                         .style("opacity", 0);
                });


            div = d3.select("body").append("div")
                        .attr("class", "tooltip")
                        .style("opacity", 0);

            // Add Title
            svg.append("text")
               .attr("transform", "translate(" + (s_width / 2) + " , 0)")
               .attr("dy", "1em")
               .style("text-anchor", "middle")
               .text(title)
               .style("font-size","1.4em");

            // Add and format X-axis
            svg.append("g")
                .attr("class", "l x axis")
                .attr("transform", "translate(0," + (s_height - margin.bottom) + ")")
                .call(xAxis)
            .selectAll("text")
                .attr("y", 6)
                .attr("x", -3)
                .style("font-size","0.8em")
                .attr("transform", "rotate(45)")
                .style("text-anchor", "start")
                .style("font-family", "Raleway");

            // Add and format X-axis label
            svg.append("text")
               .attr("transform", "translate(" + (s_width - margin.right/2) + " ," +
                   (s_height) + ")")
               .style("text-anchor", "middle")
               .text("Date of Sale")
               .style("font-size","0.8em");

            // Add and format Y-axis
            svg.append("g")
                .attr("class", "l y axis")
                .attr("transform", "translate(" + margin.left + ",0)")
                .call(yAxis)
            .selectAll("text")
                .style("font-size","0.8em")
                .style("font-family", "Raleway");

            // Add and format Y-axis label
            svg.append("text")
                .attr('class', 'y-axis-label')
                .attr("transform", "rotate(-90)")
                .attr("y", 0)
                .attr("x",0 - (s_height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Average Weekly " + y_axis_label)
                .style("font-size","0.8em");

            var symbolScale =  d3.scaleOrdinal()
              .domain(['2nd Hand Properties', 'New Properties'])
              .range(['#05084E', '#B32650']);

            svg.append("g")
              .attr("class", "legendOrdinal")
              .attr("transform", "translate(" + (s_width - margin.right - 40) + "," + (margin.top) + ")");

            var legendOrdinal = d3.legendColor()
              .shape("path", d3.symbol().type(d3.symbolCircle).size(20)())
              .scale(symbolScale)
              .orient("vertical")
              .shapePadding(2);

            svg.select(".legendOrdinal")
              .call(legendOrdinal);

            svg.selectAll('.swatch')
                .attr("transform", "translate(5, 2)");

            svg.selectAll(".label")
                .style("font-size","0.6em")
                .style('font-weight', 'normal');

            function ajax_get_scat(id, time, agg){
                if (document.getElementById('sc-7-' + id +'-' + 1) == null){
                    cid = id.slice(5,6);
                } else {
                    cid = id
                }

                $.ajax({
                    type: "GET",
                    url: "/reporter/ajax-response-chart/",
                    data: {'chart': 'scatter', 'time': time, 'agg': agg.slice(0, 1), 'chart_id': cid},
                    async: true,
                    dataType: 'json',
                    beforeSend: function () {
                        mid = id.slice(5,6);
                        for (var i = 1; i < 8; i++) {
                            if (document.getElementById('sc-7-' + id +'-' + i) == null){
                                $('#sc-7-' + mid +'-' + i).attr('disabled', true);
                            } else {
                                // Chrome
                                document.getElementById('sc-7-' + id +'-' + i).setAttribute('disabled', true);
                            }
                        }

                        for (var i = 1; i < 4; i++) {
                            if (document.getElementById('sc-3-' + id + "1-" + i) == null){
                                $('#sc-3-' + mid + "1-" + i).attr('disabled', true);
                            } else {
                                // Chrome
                                document.getElementById('sc-3-' + id + "1-" + i).setAttribute('disabled', true);
                            }
                        }
                    },
                    success: function (data) {
                        mid = id.slice(5,6);
                        for (var i = 1; i < 8; i++) {
                            if (document.getElementById('sc-7-' + id +'-' + i) == null){

                                $('#sc-7-' + mid +'-' + i).attr('disabled', false);
                            } else {
                                // Chrome
                                document.getElementById('sc-7-' + id +'-' + i).removeAttribute('disabled');
                            }
                        }
                        for (var i = 1; i < 4; i++) {
                            if (document.getElementById('sc-3-' + id + "1-" + i) == null){

                                $('#sc-3-' + mid + "1-" + i).attr('disabled', false);
                            } else {
                                // Chrome
                                document.getElementById('sc-3-' + id + "1-" + i).removeAttribute('disabled');
                            }
                        }

                        scatter_data = data['scatter_data'];

                        combdata = [];

                        for (var i = 0; i < scatter_data.length; i++){
                            if (scatter_data[i][1] > 0){
                                combdata.push([scatter_data[i][0], scatter_data[i][1], 'used'])
                            }
                            if (scatter_data[i][2] > 0){
                                combdata.push([scatter_data[i][0], scatter_data[i][2], 'new'])
                            }
                        }

                        yMin = 0;

                        yMax = d3.max(combdata, function (d) {
                            return d[1];
                        });

                        deltaY = yMax * 0.1;

                        yScale.domain([0, yMax + deltaY]);

                        xMin = d3.min(combdata, function (d) {
                            return d[0];
                        });
                        xMax = d3.max(combdata, function (d) {
                            return d[0];
                        });

                        xScale.domain([xMin, xMax]);

                        //Update x-axis
                        svg.select(".l.x.axis")
                            .transition()
                            .duration(1000)
                            .call(xAxis);

                        var y_prefix;

                        if (data['agg'] == 'W'){
                            y_prefix = 'Average Weekly '
                        } else if (data['agg'] == 'D'){
                            y_prefix = 'Average '
                        } else {
                            y_prefix = 'Average Monthly '
                        }

                        svg.select('.y-axis-label')
                            .text(y_prefix + y_axis_label);

                        svg.select(".l.x.axis")
                            .selectAll("text")
                            .style("font-size","0.8em")
                            .attr("transform", "rotate(45)")
                            .style("text-anchor", "start")
                            .style("font-family", "Raleway");

                        //Update y-axis
                        svg.select(".l.y.axis")
                            .transition()
                            .duration(1000)
                            .call(yAxis);

                        svg.select(".l.y.axis")
                            .selectAll("text")
                            .style("font-size","0.8em")
                            .style("font-family", "Raleway");

                        var circs = svg.selectAll("circle")
                            .data(combdata);

                        circs.transition()
                            .delay(function(d, i) {
                                return i / combdata.length * 1000;   // <-- Where the magic happens
                            })
                            .duration(1000)
                            .attr("cx", function (d) {
                                return xScale(d[0]);
                            })
                            .attr("cy", function (d) {
                                return yScale(d[1])
                            }).style("fill", function(d) {
                              if (d[2] == 'used'){
                                  return '#05084E';
                              } else {
                                  return '#B32650'
                              }
                          });

                        circs.exit()
                            .transition()
                            .style("opacity", 0)
                            .duration(1000)
                            .remove();

                        var newcircs = svg.selectAll("circle")
                            .data(combdata)
                            .enter()
                            .append("circle")
                            .attr("cx", function (d) {
                                return xScale(d[0]);
                            })
                            .attr("cy", function (d) {
                                return yScale(d[1]);
                            })
                            .attr("r", 2)
                            .style("fill", function(d) {
                                  if (d[2] == 'used'){
                                      return '#05084E';
                                  } else {
                                      return '#B32650'
                                  }
                              })
                            .style('opacity', 0);

                        newcircs.transition()
                            .delay(function(d, i) {
                                return i / combdata.length * 1000;
                            })
                            .duration(1000)
                            .style("opacity", .65);


                        newcircs.on("mouseover", function(d) {
                            d3.select(this)
                                .style('opacity', 1)
                                .attr('r', 3);

                            div.transition()
                                .duration(200)
                                .style("opacity", .9);
                            t = new Date(d[0]);

                            if ($("#scS31 input[type='radio']:checked")[0].labels == null){
                                var selector = document.getElementsByName('sc-S31');
                                for(var i = 0; i < selector.length; i++) {
                                    //Check if button is checked
                                    var button = selector[i];
                                    if(button.checked) {
                                        //Return value
                                        id = button.id;
                                    }
                                }

                                if (id.slice(id.length - 1) == 1){
                                    agg = 'Daily';
                                } else if (id.slice(id.length - 1) == 2){
                                    agg = 'Weekly'
                                } else if (id.slice(id.length - 1) == 3){
                                    agg = 'Monthly'
                                }

                            } else {
                                // Chrome
                                agg = $("#scS31 input[type='radio']:checked")[0].labels[0].innerHTML;
                            }

                            var tooltip_label;

                            if (agg == 'Weekly'){
                                tooltip_label = 'Week of ' + t.getDate() + '-' +
                                monthNames[t.getUTCMonth()] + "-" +
                                String(t.getUTCFullYear());
                            } else if (agg == 'Daily'){
                                tooltip_label = t.getDate() + '-' +
                                monthNames[t.getUTCMonth()] + "-" +
                                String(t.getUTCFullYear());
                            } else {
                                tooltip_label = monthNames[t.getUTCMonth()] + "-" +
                                String(t.getUTCFullYear());
                            }

                            if (d[2] === "used"){
                                tooltip_label = "2nd Hand Properties<br/>" + tooltip_label
                            } else {
                                tooltip_label = "New Properties<br/>" + tooltip_label
                            }

                            div.html(tooltip_label + "<br>" + label + thousandsDisplay(d[1]))
                                .style("left", (d3.event.pageX) + "px")
                                .style("top", (d3.event.pageY - 28) + "px");

                            })
                        .on("mouseout", function(d) {
                            d3.select(this)
                                .style('opacity', 0.65)
                                .attr('r', 2);
                            div.transition()
                                 .duration(500)
                                 .style("opacity", 0);
                        });
                    }
                });
            }

            d3.select("#" + seq_id + "-1")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "1 Month", agg)
                });
            d3.select("#" + seq_id + "-2")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "3 Months", agg)
                });
            d3.select("#" + seq_id + "-3")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "6 Months", agg)
                });
            d3.select("#" + seq_id + "-4")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "1 Year", agg)
                });
            d3.select("#" + seq_id + "-5")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "2 Years", agg)
                });
            d3.select("#" + seq_id + "-6")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "5 Years", agg)
                });
            d3.select("#" + seq_id + "-7")
                .on("click", function () {
                    id = seq_id.substr(seq_id.length -1);
                    if ($("#scS" + id + "1 input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "1");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1){
                            agg = 'Daily';
                        } else if (id.slice(id.length - 1) == 2){
                            agg = 'Weekly'
                        } else {
                            agg = 'Monthly'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, "All", agg)
                });

            d3.select('#' + seq_id.replace("7", "3") + "1-1")
                .on("click", function () {
                    seq_id_3 = seq_id.replace("7", "3");
                    id = seq_id_3.substr(seq_id_3.length - 1);

                    if ($("#scS" + id + " input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1) {
                            agg = '1 Month';
                        } else if (id.slice(id.length - 1) == 2) {
                            agg = '2 Months'
                        } else if (id.slice(id.length - 1) == 3) {
                            agg = '6 Months'
                        } else if (id.slice(id.length - 1) == 4) {
                            agg = '1 Year'
                        } else if (id.slice(id.length - 1) == 5) {
                            agg = '2 Years'
                        } else if (id.slice(id.length - 1) == 6) {
                            agg = '5 Years'
                        } else {
                            agg = 'All'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + " input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, agg, "Daily")
                });
            d3.select('#' + seq_id.replace("7", "3") + "1-2")
                .on("click", function () {
                    seq_id_3 = seq_id.replace("7", "3");
                    id = seq_id_3.substr(seq_id_3.length -1);
                    if ($("#scS" + id + " input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1) {
                            agg = '1 Month';
                        } else if (id.slice(id.length - 1) == 2) {
                            agg = '2 Months'
                        } else if (id.slice(id.length - 1) == 3) {
                            agg = '6 Months'
                        } else if (id.slice(id.length - 1) == 4) {
                            agg = '1 Year'
                        } else if (id.slice(id.length - 1) == 5) {
                            agg = '2 Years'
                        } else if (id.slice(id.length - 1) == 6) {
                            agg = '5 Years'
                        } else {
                            agg = 'All'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + " input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, agg, "Weekly")
                });
            d3.select('#' + seq_id.replace("7", "3") + "1-3")
                .on("click", function () {
                    seq_id_3 = seq_id.replace("7", "3");
                    id = seq_id_3.substr(seq_id_3.length -1);
                    if ($("#scS" + id + " input[type='radio']:checked")[0].labels == null){
                        var selector = document.getElementsByName('sc-S' + id + "");
                        for(var i = 0; i < selector.length; i++) {
                            //Check if button is checked
                            var button = selector[i];
                            if(button.checked) {
                                //Return value
                                id = button.id;
                            }
                        }

                        if (id.slice(id.length - 1) == 1) {
                            agg = '1 Month';
                        } else if (id.slice(id.length - 1) == 2) {
                            agg = '2 Months'
                        } else if (id.slice(id.length - 1) == 3) {
                            agg = '6 Months'
                        } else if (id.slice(id.length - 1) == 4) {
                            agg = '1 Year'
                        } else if (id.slice(id.length - 1) == 5) {
                            agg = '2 Years'
                        } else if (id.slice(id.length - 1) == 6) {
                            agg = '5 Years'
                        } else {
                            agg = 'All'
                        }

                    } else {
                        // Chrome
                        agg = $("#scS" + id + " input[type='radio']:checked")[0].labels[0].innerHTML;
                    }

                    ajax_get_scat(id, agg, "Monthly")
                });
        }

        function drawHistogram(data, chart_name){
            data_list = [];
            for (var key in data) {
                for (var i = 0; i < data[key]; i++) {
                    data_list.push(parseInt(key));
                }
            }
            na_list = [];

            for (var key in na_hist_data) {
                for (var i=0; i < na_hist_data[key]; i++){
                    na_list.push(parseInt(key));
                }
            }

            margin = {top: 30, right: 60, bottom: 30, left: 60};

            s_height = height - 250;
            s_width = width;

            var container = d3.select("div#" + chart_name + "-cont")
                .style("width", s_width);

            var svg = d3.select("svg#chart-" + chart_name + "")
                .attr("viewBox", "0 0 " + s_width + " " + s_height);

            window.onresize = function(){
                var scale = s_width / container.node().getBoundingClientRect().width;

                // Update SVG height to maintain aspect ratio
                svg.attr("height", s_height / scale);

                $('.sales-chart-row').css('height', (s_height / scale ));
                $('.s-chart').css('height', (s_height / scale ));
            };

            xMax = d3.max(data_list, function (d) {
                return d
            });

            xScale = d3.scaleLinear()
                .domain([0, xMax])
                .rangeRound([margin.left, s_width - margin.right - 10]);

            bins = d3.histogram()
                .domain(xScale.domain())
                .thresholds(xScale.ticks(20))
                (data_list);

            xAxis = d3.axisBottom()
                .scale(xScale)
                .tickFormat(function (d) {
                    var val;
                    if (d >= 1000000) {
                        val = d / 1000000 + ' M'
                    } else if (d == 0) {
                        val = 0
                    } else {
                        val = d / 1000 + ' k'
                    }
                    return ' ' + val
                })
                .tickSizeOuter(0);

            line_bins = d3.histogram()
                .domain(xScale.domain())
                .thresholds(xScale.ticks(20))
                (na_list);

            yMin = 0;
            yMaxA = d3.max(bins, function (d) {
                return d.length;
            });

            yMaxB = d3.max(line_bins, function(d){
                return d.length
            });

            if (yMaxA > yMaxB){
                yMax = yMaxA
            } else {
                yMax = yMaxB
            }

            deltaY = (yMax - yMin) * 0.01;

            yScale = d3.scaleLinear()
                .domain([yMin, yMax + deltaY])
                .range([s_height - margin.bottom, margin.top]);

            yAxis = d3.axisLeft()
                .scale(yScale)
                .ticks(5)
                .tickSizeOuter(0);

            div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            svg.append("defs").append("clipPath")
                .attr("id", "clip")
              .append("rect")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                .attr("width", s_width - margin.left - margin.right)
                .attr("height", s_height - margin.bottom - margin.top);

            var line = d3.line()
                .curve(d3.curveBundle.beta(1))
                .x(function(d) { return xScale((d.x1 - d.x0)/2 + d.x0); })
                .y(function(d) { return yScale(d.length); });

            var bar = svg.selectAll(".bar")
                .data(bins)
                .enter()
                .append("g")
                .attr("class", "bar")
                .attr("transform", function (d) {
                    return "translate" + "(" + xScale(d.x0) +
                        "," + (yScale(d.length)) + ")";
                })
                .style("fill", "#05084E")
                .on("mouseover", function (d) {
                    d3.select(this).style("fill", "#B32650");
                    div.transition()
                        .duration(200)
                        .style("opacity", 1);
                    div.html('' + thousandsDisplay(d.x0) + " - " +
                        thousandsDisplay(d.x1) + "<br>Count: " + d.length)
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY - 38) + "px");
                })
                .on("mouseout", function (d) {
                    d3.select(this)
                        .style("fill", "#05084E");
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            bar.append("rect")
                .attr("x", 1)
                .attr("width", xScale(bins[0].x1) - xScale(bins[0].x0) - 1)
                .attr("height", function (d) {
                    return s_height - margin.bottom - yScale(d.length);
                })
                .style("opacity", .7);

            svg.append("g")
                .attr("clip-path", "url(#clip)")
                .append("path")
              .datum(line_bins)
              .attr('class', 'line')
              .attr("fill", "none")
              .attr("stroke", "#B32650")
              .attr("stroke-linejoin", "round")
              .attr("stroke-linecap", "round")
              .attr("stroke-width", 2)
              .attr("d", line);

            // Add Title
            svg.append("text")
                .attr("transform", "translate(" + (s_width / 2) + " , 0)")
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Histogram of Sales")
                .style("font-size", "1.4em");

            // Add and format X-axis
            svg.append("g")
                .attr("class", "r x axis")
                .attr("transform", "translate(0," + (s_height - margin.bottom) + ")")
                .call(xAxis)
                .selectAll("text")
                .attr("y", 6)
                .attr("x", -3)
                .style("font-size", "0.8em")
                .attr("transform", "rotate(45)")
                .style("text-anchor", "start")
                .style("font-family", "Raleway");

            // Add and format X-axis label
            svg.append("text")
                .attr("transform", "translate(" + (s_width - margin.right / 2 - 5) + " ," +
                    (s_height) + ")")
                .style("text-anchor", "middle")
                .text("Sale Price ()")
                .style("font-size", "0.8em");

            // Add and format Y-axis
            svg.append("g")
                .attr("class", "r y axis")
                .attr("transform", "translate(" + margin.left + ",0)")
                .call(yAxis)
                .selectAll("text")
                .style("font-size", "0.8em")
                .style("font-family", "Raleway");

            // Add and format Y-axis label

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 5)
                .attr("x", 0 - (s_height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Count")
                .style("font-size", "0.8em");

            var circle = d3.symbol().type(d3.symbolCircle).size(20)();

            var symbolScale =  d3.scaleOrdinal()
              .domain(['National Average'])
              .range([circle]);

            svg.append("g")
              .attr("class", "legendSymbol")
              .attr("transform", "translate(" + (s_width - margin.right - 40) + "," + (margin.top) + ")");

            var legendPath = d3.legendSymbol()
              .scale(symbolScale)
              .orient("vertical")
              .labelWrap(100);

            svg.select(".legendSymbol")
              .call(legendPath)
              .style("font-size","0.8em")
                .style('font-weight', 'normal');

            svg.select('.swatch')
                .style('fill', '#B32650')
                .attr("transform", "translate(8, 2)");

            function ajax_get_hist(time, id){
                $.ajax({
                    type: "GET",
                    url: "/reporter/ajax-response-chart/",
                    data: {'chart': 'hist', 'time': time},
                    async: true,
                    dataType: 'json',
                    beforeSend: function(){
                        for (var i = 1; i < 8; i ++){
                            document.getElementById(id + i).setAttribute('disabled', true);
                        }
                    },
                    success: function (data) {
                        for (var i = 1; i < 8; i ++){
                            document.getElementById(id + i).removeAttribute('disabled');
                        }

                        hist_dict = data['hist_data'];
                        na_hist_data = data['na_hist'];

                        data_list = [];

                        for (var key in hist_dict) {
                            for (var i=0; i < hist_dict[key]; i++){
                                data_list.push(parseInt(key));
                            }
                        }

                        na_list = [];

                        for (var key in na_hist_data) {
                            for (var i=0; i < na_hist_data[key]; i++){
                                na_list.push(parseInt(key));
                            }
                        }

                        xMax = d3.max(data_list, function (d) {
                            return d
                        });

                        xScale.domain([0, xMax]);

                        xAxis.scale(xScale);

                        var bins = d3.histogram()
                            .domain(xScale.domain())
                            .thresholds(xScale.ticks(20))
                            (data_list);

                        line_bins = d3.histogram()
                            .domain(xScale.domain())
                            .thresholds(xScale.ticks(20))
                            (na_list);

                        yMin = 0;
                        yMaxA = d3.max(bins, function (d) {
                            return d.length;
                        });

                        yMaxB = d3.max(line_bins, function(d){
                            return d.length
                        });

                        if (yMaxA > yMaxB){
                            yMax = yMaxA
                        } else {
                           yMax = yMaxB
                        }

                        deltaY = (yMax - yMin) * 0.01;

                        yScale.domain([yMin, yMax + deltaY]);

                        yAxis.scale(yScale);

                        line.x(function(d) { return xScale((d.x1 - d.x0)/2 + d.x0); })
                            .y(function(d) { return yScale(d.length); });

                        svg.select(".line")
                          .datum(line_bins)
                          .transition()
                            .duration(1000)
                            .ease(d3.easeLinear)
                        .attr("d", line);

                        var bars = svg.selectAll(".bar").data(bins);

                        bars.transition()
                            .duration(2000)
                            .attr("transform", function (d) {
                                return "translate" + "(" + xScale(d.x0) +
                                    "," + (yScale(d.length)) + ")";
                            });

                        bars.select("rect")
                            .transition()
                            .duration(2000)
                            .attr("height", function (d) {
                                return s_height - margin.bottom -
                                    yScale(d.length);
                            })
                            .attr("width", xScale(bins[0].x1) - xScale(bins[0].x0) - 1);

                        bars.exit()
                            .transition()
                            .style("opacity", 0)
                            .duration(1000)
                            .remove();

                        var newbars = svg.selectAll(".bar")
                            .data(bins)
                            .enter()
                            .append("g")
                            .attr("class", "bar")
                            .attr("transform", function (d) {
                                return "translate" + "(" + xScale(d.x0) +
                                    "," + (yScale(d.length)) + ")";
                            })
                            .style("fill", "#05084E")
                            .on("mouseover", function (d) {
                                d3.select(this).style("fill", "#B32650");
                                div.transition()
                                    .duration(200)
                                    .style("opacity", 1);
                                div.html('' + thousandsDisplay(d.x0) + " - " +
                                    thousandsDisplay(d.x1) + "<br>Count: " + d.length)
                                    .style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY - 38) + "px");
                            })
                            .on("mouseout", function (d) {
                                d3.select(this).style("fill", "#05084E");
                                div.transition()
                                    .duration(500)
                                    .style("opacity", 0);
                            });

                        newbars.append("rect")
                            .attr("x", 1)
                            .attr("opacity", 0.7)
                            .attr("width", xScale(bins[0].x1) - xScale(bins[0].x0) - 1)
                            .attr("height", function (d) {
                                return s_height - margin.bottom - yScale(d.length);
                            });

                        newbars
                            .transition()
                            .duration(2000);

                        //Update x-axis
                        svg.select(".r.x.axis")
                            .transition()
                            .duration(2000)
                            .call(xAxis);

                        svg.select(".r.x.axis")
                            .selectAll("text")
                            .style("font-size","0.8em")
                            .attr("transform", "rotate(45)")
                            .style("text-anchor", "start")
                            .style("font-family", "Raleway");

                        //Update y-axis
                        svg.select(".r.y.axis")
                            .transition()
                            .duration(2000)
                            .call(yAxis);

                        svg.select(".r.y.axis")
                            .selectAll("text")
                            .style("font-size","0.8em")
                            .style("font-family", "Raleway");
                    }
                });
            }

            d3.select("#sc-7-4-1")
                .on("click", function() {
                    ajax_get_hist('1 Month', 'sc-7-4-')
                });

            d3.select("#sc-7-4-2")
                .on("click", function() {
                    ajax_get_hist('3 Months', 'sc-7-4-')
                });

            d3.select("#sc-7-4-3")
                .on("click", function() {
                    ajax_get_hist('6 Months', 'sc-7-4-')
                });

            d3.select("#sc-7-4-4")
                .on("click", function() {
                    ajax_get_hist('1 Year', 'sc-7-4-')
                });

            d3.select("#sc-7-4-5")
                .on("click", function() {
                    ajax_get_hist('2 Years', 'sc-7-4-')
                });

            d3.select("#sc-7-4-6")
                .on("click", function() {
                    ajax_get_hist('5 Years', 'sc-7-4-')
                });

            d3.select("#sc-7-4-7")
                .on("click", function() {
                    ajax_get_hist('All', 'sc-7-4-')
                });
        }

        function drawPieChart(data, chart_name, before_top, after_top, desc, title){

            margin = {top: 40, right: 20, bottom: 30, left: 20};

            w = width;
            h = height;

            var ndata = data.slice();
            
            ind = get_index(chart_name);

            if (ind > 0){
                for (var i = 0; i < ndata.length; i++){
                    if (pop_perc(ndata[i].value, ndata) < 2 && i != ind) {
                        ndata[ind].value += ndata[i].value;
                        ndata[i].value = 0;
                        ndata[i].opacity = 0;
                    } else {
                        ndata[i].opacity = 1;
                    }
                }
            } else if (ind == -1){
                for (var j = 0; j < ndata.length; j++){
                    if (pop_perc(ndata[j].value, ndata) < 2) {
                        lab = ndata[j].label;
                        if (lab == 'United Kingdom' || lab == 'Polish' || lab == 'Lithuanian'){
                            ndata[4].value += ndata[j].value;
                            ndata[j].value = 0;
                            ndata[j].opacity = 0;
                        } else if (lab == 'Rest of World' || 'Other EU'){
                            ndata[6].value += ndata[j].value;
                            ndata[j].value = 0;
                            ndata[j].opacity = 0;
                        } else {
                            ndata[j].opacity = 1;
                        }
                    }
                }
            } else {
                for (var k = 0; k < ndata.length; k++){
                    if (pop_perc(ndata[k].value, ndata) < 2){
                        ndata[k].value = 0;
                        ndata[k].opacity = 0;
                    } else {
                        ndata[k].opacity = 1;
                    }
                }
            }

            var container = d3.select("div#" + chart_name + "-cont")
                .style("w", width);

            var svg = d3.select("svg#chart-" + chart_name + "")
                .attr("viewBox", "0 0 " + w + " " + h);

            window.onresize = resized(svg, container);

            var radius = Math.min(w - margin.left - margin.right, h - margin.top - margin.bottom) / 2 + 20;
                g = svg.append("g").attr("transform", "translate(" + ((w/ 2)) + "," + ((h / 2) + 5) + ")");

            var wr = d3.textwrap()
              .bounds({height: 12, width: (radius - 15)/2})
              .method('tspans');

            var pie = d3.pie()
                .sort(null)
                .value(function(d) {
                    return d.value;
                });

            var arc = d3.arc()
                .outerRadius(radius - 15)
                .innerRadius(0);

            var label = d3.arc()
                .outerRadius(radius - 30);

            var path = g
                .selectAll(".arc")
                .data(pie(ndata))
                .enter().append('g')
                .attr("class", "arc");

            path.append("path")
                .attr("d", arc)
                .style("fill", "#05084E")
                .style("opacity", .65)
                .on("mouseover", function(d) {
                    d3.select(this)
                        .style('opacity', 1)
                        .attr('r', 3)
                        .style("fill", "#B32650");
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);

                        div.html(before_top + ": " + d.data.label + " " + after_top + "<br>" +
                            desc + ": " + thousandsDisplay(d.value) +
                            "<br>Percentage: " + pop_perc(d.value, ndata) + '%' +
                            "<br>National Average: " + get_natave(d.data.label, chart_name, 2016))
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");

                    })
                .on("mouseout", function(d) {
                        d3.select(this).style('opacity', 0.65).attr('r', 2).style
                        ("fill", "#05084E");
                        div.transition()
                             .duration(500)
                             .style("opacity", 0);
                    });

              path.append("text")
                  .attr("transform", function(d) {
                      ang = 180 / Math.PI * (d.startAngle + d.endAngle) / 2 - 90;
                      if (ang > 90){
                          d.innerRadius = radius - 20;
                      } else {
                            if (d.data.label == 'Commerce and Trade'){
                                d.innerRadius = radius - 120;
                            } else if (d.data.label == 'Associate Professional and Technical Occupations'){
                                d.innerRadius = radius - 60;
                            } else if (d.data.label == 'Administrative and Secretarial Occupations'){
                                d.innerRadius = radius - 70;
                            } else if (d.data.label == 'Managerial and Technical'){
                                d.innerRadius = radius - 90;
                            } else if (d.data.label == 'Rented from Local Authority'){
                                d.innerRadius = radius - 120;
                            } else if (d.data.label == 'Owner Occupier with Mortgage'){
                                d.innerRadius = radius - 135;
                            } else if (d.data.label == 'Owner Occupier without Mortgage'){
                                d.innerRadius = radius - 20;
                            } else if (d.data.label == 'Rented from Private Landlord') {
                                d.innerRadius = radius - 130;
                            } else if (d.data.label == 'Agriculture, Forestry and Fishing'){
                                d.innerRadius = radius - 110;
                            } else {
                                d.innerRadius = radius - 20;
                            }
                      }

                    d.outerRadius = radius - 20;

                    return "translate(" + label.centroid(d) + ") " + "rotate(" + getAngle(d) + ")";
                  })
                  .attr("text-anchor", "start")
                  .attr("dy", 0)
                  .attr("dx", 0)
                  .text(function(d) {
                      if (chart_name == 'six' && d.data.label != 'More than Eight Person Household'){
                          return d.data.label.split(/\s+/)[0]
                      }
                      return d.data.label;
                  })
                  .style('text-anchor', function(d){
                    ang = 180 / Math.PI * (d.startAngle + d.endAngle) / 2 - 90;
                      if (ang > 90){
                          return "start"
                      } else {
                          return "end"
                      }
                })
                    .style("font-size","0.8em")
                    .style("font-family", "Raleway")
                    .style('fill', 'white')
                      .style('opacity', function(d){
                          return d.data.opacity;
                      });

              path.selectAll("text")
                .call(wr);

              var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

              svg.append("text")
               .attr("transform", "translate(" + (w / 2) + " , 0)")
               .attr("dy", "1em")
               .style("text-anchor", "middle")
               .text(title)
               .style("font-size","1.6em");

              function ajax_get_pie(year){
                $.ajax({
                    type: "GET",
                    url: "/reporter/ajax-response-pie/",
                    data: {'chartname': chart_name, 'year': year},
                    async: true,
                    dataType: 'json',
                    success: function (newdata) {
                        ind = get_index(chart_name);
  
                        if (ind > 0){
                            for (var i = 0; i < newdata.length; i++){
                                if (pop_perc(newdata[i].value, newdata) < 2 && i != ind) {
                                    newdata[ind].value += newdata[i].value;
                                    newdata[i].value = 0;
                                    newdata[i].opacity = 0;
                                } else {
                                    newdata[i].opacity = 1
                                }
                            }
                        } else if (ind == -1){
                            for (var j = 0; j < newdata.length; j++){
                                if (pop_perc(newdata[j].value, newdata) < 2) {
                                    lab = newdata[j].label;
                                    if (lab == 'United Kingdom' || lab == 'Polish' || lab == 'Lithuanian'){
                                        newdata[4].value += newdata[j].value;
                                        newdata[j].value = 0;
                                        newdata[j].opacity = 0;
                                    } else if (lab == 'Rest of World' || 'Other EU'){
                                        newdata[6].value += newdata[j].value;
                                        newdata[j].value = 0;
                                        newdata[j].opacity = 0;
                                    } else {
                                        newdata[j].opacity = 1
                                    }
                                }
                            }
                        } else {
                            for (var k = 0; k < newdata.length; k++){
                                if (pop_perc(newdata[k].value, newdata) < 2){
                                    newdata[k].value = 0;
                                    newdata[k].opacity = 0;
                                } else {
                                    newdata[k].opacity = 1
                                }
                            }
                        }

                        function arcTween(a) {
                            var i = d3.interpolate(this._current, a);
                            this._current = i(0);
                            return function(t) {
                                return arc(i(t));
                            };
                        }

                        pie.value(function(d) {
                            return d.value;
                        });

                        path = svg.selectAll("path")
                            .data(pie(newdata))
                            .on("mouseover", function(d) {

                                d3.select(this)
                                    .style('opacity', 1)
                                    .attr('r', 3)
                                    .style("fill", "#B32650");
                                div.transition()
                                    .duration(200)
                                    .style("opacity", .9);

                                    div.html(before_top + ": " + d.data.label + " " + after_top + "<br>" +
                                        desc + ": " + thousandsDisplay(d.value) +
                                        "<br>Percentage: " + pop_perc(d.value, newdata) + '%' +
                                        "<br>National Average: " + get_natave(d.data.label, chart_name,year))
                                        .style("left", (d3.event.pageX) + "px")
                                        .style("top", (d3.event.pageY - 28) + "px");

                                })
                            .on("mouseout", function(d) {
                            d3.select(this).style('opacity', 0.65).attr('r', 2).style
                            ("fill", "#05084E");
                            div.transition()
                                 .duration(500)
                                 .style("opacity", 0);
                        });

                        path.transition()
                            .duration(1000)
                            .attrTween("d", arcTween);

                        svg.selectAll("text")
                            .data(pie(newdata))
                            .transition().duration(1000)
                            .style('text-anchor', function(d){
                            ang = 180 / Math.PI * (d.startAngle + d.endAngle) / 2 - 90;
                              if (ang > 90){
                                  return "start"
                              } else {
                                  return "end"
                              }
                        })
                            .attr("transform", function(d) {
                                ang = (d.startAngle + d.endAngle)/2 * 180 / Math.PI - 90;
                                if (ang > 90){
                                    corr = 180;
                                    offset = radius - 30;
                                } else {
                                    corr = 0;
                                    if (d.data.label == 'Commerce and Trade'){
                                        offset = radius - 78;
                                    } else if (d.data.label == 'Associate Professional and Technical Occupations'){
                                        offset = radius - 50;
                                    } else if (d.data.label == 'Administrative and Secretarial Occupations'){
                                        offset = radius - 60;
                                    } else if (d.data.label == 'Managerial and Technical'){
                                        offset = radius - 58;
                                    } else if (d.data.label == 'Rented from Local Authority'){
                                        offset = radius - 120;
                                    } else if (d.data.label == 'Owner Occupier with Mortgage'){
                                        offset = radius - 85;
                                    } else if (d.data.label == 'Owner Occupier without Mortgage'){
                                        offset = radius - 20;
                                    } else if (d.data.label == 'Rented from Private Landlord') {
                                        offset = radius - 130;
                                    } else if (d.data.label == 'Agriculture, Forestry and Fishing'){
                                        offset = radius - 68;
                                    } else {
                                        offset = radius - 30;
                                    }
                                }
                                return "rotate(" + ang + ")" + "translate(" + (offset) + ",0)" + "rotate(" + corr + ")";
                            })
                            .style('opacity', function(d){
                                    return d.data.opacity;
                                });
                    }
                });
            }


            segcon = {
                'two': 'sc-2-21',
                'three': 'sc-2-31',
                'four': 'sc-2-41',
                'five': 'sc-2-51',
                'six': 'sc-2-61',
                'seven': 'sc-2-71',
                'eight': 'sc-2-81',
                'nine': 'sc-2-91',
                'ten': 'sc-2-101',
                'eleven': 'sc-2-111',
                'twelve': 'sc-2-121',
                'thirteen': 'sc-2-131',
                'fourteen': 'sc-2-141',
                'fifteen': 'sc-2-151',
                'sixteen': 'sc-2-161',
                'seventeen': 'sc-2-171',
                'eighteen': 'sc-2-181'
            };

            segcont = {
                'two': 'sc2',
                'three': 'sc3',
                'four': 'sc4',
                'five': 'sc5',
                'six': 'sc6',
                'seven': 'sc7',
                'eight': 'sc8',
                'nine': 'sc9',
                'ten': 'sc10',
                'eleven': 'sc11',
                'twelve': 'sc12',
                'thirteen': 'sc13',
                'fourteen': 'sc14',
                'fifteen': 'sc15',
                'sixteen': 'sc16',
                'seventeen': 'sc17',
                'eighteen': 'sc18'
            };


            if (chart_name == 'one'){
                seg_control = 'sc-2-1';

                if ($("#sc0 input[type='radio']:checked")[0].labels == null){
                    var selector = document.getElementsByName('sc-0');
                    for(var i = 0; i < selector.length; i++) {
                        //Check if button is checked
                        var button = selector[i];
                        if(button.checked) {
                            //Return value
                            id = button.id;
                        }
                    }

                    if (id.slice(id.length - 1) == 1){
                        agg = 'Pie';
                    } else if (id.slice(id.length - 1) == 2){
                        agg = 'Bar'
                    } else if (id.slice(id.length - 1) == 3){
                        agg = 'Forest'
                    }

                } else {
                    // Chrome
                    agg = $("#sc0 input[type='radio']:checked")[0].labels[0].innerHTML;
                }

            } else {
                seg_control = segcon[chart_name];
            }

            d3.select("#" + seg_control + "-1")
                .on("click", function() {
                    if (chart_name == 'one') {
                        if ($("#sc0 input[type='radio']:checked")[0].labels == null){
                            var selector = document.getElementsByName('sc-0');
                            for(var i = 0; i < selector.length; i++) {
                                //Check if button is checked
                                var button = selector[i];
                                if(button.checked) {
                                    //Return value
                                    id = button.id;
                                }
                            }

                            if (id.slice(id.length - 1) == 1){
                                agg = 'Pie';
                            } else if (id.slice(id.length - 1) == 2){
                                agg = 'Bar'
                            } else if (id.slice(id.length - 1) == 3){
                                agg = 'Forest'
                            }

                        } else {
                            // Chrome
                            agg = $("#sc0 input[type='radio']:checked")[0].labels[0].innerHTML;
                        }
                    } else {
                        if ($("#" + segcont[chart_name] + " input[type='radio']:checked")[0].labels == null){
                            var selector = document.getElementsByName(segcont[chart_name]);
                            for(var i = 0; i < selector.length; i++) {
                                //Check if button is checked
                                var button = selector[i];
                                if(button.checked) {
                                    //Return value
                                    id = button.id;
                                }
                            }

                            if (id.slice(id.length - 1) == 1){
                                agg = 'Pie';
                            } else {
                                agg = 'Bar'
                            }

                        } else {
                            // Chrome
                            agg = $("#" + segcont[chart_name] + " input[type='radio']:checked")[0].labels[0].innerHTML;
                        }
                    }

                    if (agg == "Pie"){
                        ajax_get_pie(2011)
                    }
                });
            d3.select("#" + seg_control + "-2")
                .on("click", function() {
                    if (chart_name == 'one') {
                        if ($("#sc0 input[type='radio']:checked")[0].labels == null){
                            var selector = document.getElementsByName('sc-0');
                            for(var i = 0; i < selector.length; i++) {
                                //Check if button is checked
                                var button = selector[i];
                                if(button.checked) {
                                    //Return value
                                    id = button.id;
                                }
                            }

                            if (id.slice(id.length - 1) == 1){
                                agg = 'Pie';
                            } else if (id.slice(id.length - 1) == 2){
                                agg = 'Bar'
                            } else if (id.slice(id.length - 1) == 3){
                                agg = 'Forest'
                            }

                        } else {
                            // Chrome
                            agg = $("#sc0 input[type='radio']:checked")[0].labels[0].innerHTML;
                        }
                    } else {
                        if ($("#" + segcont[chart_name] + " input[type='radio']:checked")[0].labels == null){
                            var selector = document.getElementsByName(segcont[chart_name]);
                            for(var i = 0; i < selector.length; i++) {
                                //Check if button is checked
                                var button = selector[i];
                                if(button.checked) {
                                    //Return value
                                    id = button.id;
                                }
                            }

                            if (id.slice(id.length - 1) == 1){
                                agg = 'Pie';
                            } else {
                                agg = 'Bar'
                            }

                        } else {
                            // Chrome
                            agg = $("#" + segcont[chart_name] + " input[type='radio']:checked")[0].labels[0].innerHTML;
                        }
                    }

                    if (agg == "Pie"){
                        ajax_get_pie(2016)
                    }
                });

        }

        function drawBarChart(data, chart_name, before_top, after_top, desc, title){

            na_data = [];
            data_total = 0;
            for (var i = 0; i < data.length; i++){
                data_total = data_total + data[i]['value'];
                na = get_natave(data[i]['label'], chart_name, 2016);
                na_data.push({
                    'value': parseFloat(na.slice(0, na.length - 1)) / 100,
                    'label': data[i]['label']
                    });
            }
            for (var i = 0; i < na_data.length; i++){
                na_data[i]['value'] = Math.round(na_data[i]['value'] * data_total, 0)
            }

            if ($("#sc0 input[type='radio']:checked")[0].labels == null) {
                margin = {top: 40, right: 0, bottom: 100, left: 90};
            } else {
                margin = {top: 40, right: 0, bottom: 75, left: 90};
            }

            w = width + 200;
            h = height + 100;

            var container = d3.select("div#" + chart_name + "-cont")
                .style("width", w);

            var svg = d3.select("svg#chart-" + chart_name + "")
                .attr("viewBox", "0 0 " + w + " " + h);

            window.onresize = resized(svg, container);

            var x = d3.scaleBand()
                      .range([margin.left, w - margin.right])
                      .padding(0.2);

            var y = d3.scaleLinear()
                      .range([h - margin.bottom, margin.top]);

            var div = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);

            x.domain(data.map(function(d) {
                return d.label;
            }));

            yMaxA = d3.max(data, function(d) {
                return d.value;
            });

            yMaxB = d3.max(na_data, function(d) {
                return d.value;
            });

            if (yMaxA > yMaxB){
                yMax = yMaxA
            } else {
                yMax = yMaxB
            }

            y.domain([0, yMax]);

            var yAxis = d3.axisLeft()
                .scale(y)
                .tickFormat(function (d) {
                    var val;
                    if (d >= 1000000) {
                        val = d / 1000000 + ' M'
                    } else if (d == 0) {
                        val = 0
                    } else if (d >= 1000) {
                        val = d / 1000 + ' k'
                    } else {
                        val = d
                    }
                    return val
                })
                .tickSizeOuter(0);

            var line = d3.line()
                .curve(d3.curveBundle.beta(1))
                .x(function(d) { return x(d.label) + x.bandwidth()/2; })
                .y(function(d) { return y(d.value); });

            var bar = svg.selectAll(".bar")
                    .data(data)
                    .enter()
                    .append("g")
                    .attr("class", "bar")
                    .attr("transform", function (d) {
                        return "translate" + "(" + x(d.label) +
                            "," + y(d.value) + ")";
                    })
                    .style("fill", "#05084E")
                        .style("opacity", .65)
                      .on("mouseover", function(d) {
                        d3.select(this)
                            .style('opacity', 1)
                            .attr('r', 3)
                            .style("fill", "#B32650");
                        div.transition()
                            .duration(200)
                            .style("opacity", .9);

                        segcont = {
                            'two': 'sc2',
                            'three': 'sc3',
                            'four': 'sc4',
                            'five': 'sc5',
                            'six': 'sc6',
                            'seven': 'sc7',
                            'eight': 'sc8',
                            'nine': 'sc9',
                            'ten': 'sc10',
                            'eleven': 'sc11',
                            'twelve': 'sc12',
                            'thirteen': 'sc13',
                            'fourteen': 'sc14',
                            'fifteen': 'sc15',
                            'sixteen': 'sc16',
                            'seventeen': 'sc17',
                            'eighteen': 'sc18'
                        };

                        if (chart_name == 'one') {
                            if ($("#sc1 input[type='radio']:checked")[0].labels == null){
                                var selector = document.getElementsByName('sc-1');
                                for(var i = 0; i < selector.length; i++) {
                                    //Check if button is checked
                                    var button = selector[i];
                                    if(button.checked) {
                                        //Return value
                                        id = button.id;
                                    }
                                }

                                if (id.slice(id.length - 1) == 1){
                                    year = 2016
                                } else {
                                    year = 2011
                                }
                            } else {
                                // Chrome
                                year = $("#sc1 input[type='radio']:checked")[0].labels[0].innerHTML;
                            }

                        } else {

                            if ($("#" + segcont[chart_name] + "1 input[type='radio']:checked")[0].labels == null){
                                var selector = document.getElementsByName(segcont[chart_name] + '1');
                                for(var i = 0; i < selector.length; i++) {
                                    //Check if button is checked
                                    var button = selector[i];
                                    if(button.checked) {
                                        //Return value
                                        id = button.id;
                                    }
                                }

                                if (id.slice(id.length - 1) == 1){
                                    year = 2016
                                } else {
                                    year = 2011
                                }
                            } else {
                                // Chrome
                                year = $("#" + segcont[chart_name] + "1 input[type='radio']:checked")[0].labels[0].innerHTML;
                            }

                        }

                        div.html(before_top + ": " + d.label + " " + after_top + "<br>" +
                            desc + ": " + thousandsDisplay(d.value) +
                            "<br>Percentage: " + pop_perc(d.value, data) + '%' +
                            "<br>National Average: " + get_natave(d.label, chart_name, year))
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");

                        })
                      .on("mouseout", function(d) {
                            d3.select(this)
                                .style('opacity', 0.65)
                                .attr('r', 2)
                                .style("fill", "#05084E");
                            div.transition()
                                 .duration(500)
                                 .style("opacity", 0);
                        });

            bar.append("rect")
                .attr("width", x.bandwidth())
                .attr("height", function(d) {
                    return h - margin.bottom - y(d.value);
                });

            svg.append("path")
                  .datum(na_data)
                  .attr('class', 'line')
                  .attr("fill", "none")
                  .attr("stroke", "#B32650")
                  .attr("stroke-linejoin", "round")
                  .attr("stroke-linecap", "round")
                  .attr("stroke-width", 4)
                  .attr("d", line);
            svg.append("g")
                .attr('class', 'xAxis')
                .call(d3.axisBottom(x))
                .attr("transform", "translate(0," + (h - margin.bottom) + ")");

            svg.selectAll("g.xAxis .tick text")
                .attr("y", 20)
                .attr("x", 0)
                .attr("dx", function(){
                    if (chart_name == 'one'){
                        return 15
                    } else {
                        return 0
                    }
                })
                .attr("dy", 0)
                .attr("transform", function(){
                    if (chart_name == 'one'){
                        return "rotate(45)"
                    } else {
                        return "rotate(0)"
                    }
                })
                .style("text-anchor", "middle")
                .style("font-size",function(){
                    if (chart_name == 'fourteen'){
                        return "1.2em"
                    } else {
                        return "1.3em"
                    }
                })
                .style("font-family", "Raleway")
                .call(wrap, 50);

            // add the y Axis
            svg.append("g")
              .attr("class", "r y axis")
              .call(yAxis)
              .attr("transform", "translate(" + margin.left + ",0)")
              .style("font-size","1.2em")
              .style("font-family", "Raleway");

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 5)
                .attr("x", 0 - (h / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text(desc)
                .style("font-size", "1.2em");

            if ($("#sc0 input[type='radio']:checked")[0].labels == null){
                //Firefox
                svg.append("text")
                    .attr("transform", "translate(" + (w / 2) + " , 0)")
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text(title)
                    .style("font-size","1.8em");
            } else {
                //Chrome
                svg.append("text")
                    .attr("transform", "translate(" + (w / 2) + " , 0)")
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text(title)
                    .style("font-size","1.8em");
            }

            var circle = d3.symbol().type(d3.symbolCircle).size(60)();

            var symbolScale =  d3.scaleOrdinal()
              .domain(['National Average'])
              .range([circle]);

            svg.append("g")
              .attr("class", "legendSymbol")
              .attr("transform", "translate(" + (s_width - margin.right/2) + "," + (margin.top - 10) + ")");

            var legendPath = d3.legendSymbol()
              .scale(symbolScale)
              .orient("vertical")
              .labelWrap(100);

            if ($("#sc0 input[type='radio']:checked")[0].labels == null){
                //Firefox

            } else {
                //Chrome
                svg.select(".legendSymbol")
                    .call(legendPath)
                    .style('font-size', '2em')
                    .style('font-weight', 'normal');
            }

            svg.select('.swatch')
                .style('fill', '#B32650')
                .attr("transform", "translate(0, -2)");

            function ajax_get_bar(year){
                $.ajax({
                    type: "GET",
                    url: "/reporter/ajax-response-pie/",
                    data: {'chartname': chart_name, 'year': year},
                    async: true,
                    dataType: 'json',
                    success: function (newdata) {
                        ind = get_index(chart_name);

                        new_na_data = [];
                        new_data_total = 0;
                        for (var i = 0; i < newdata.length; i++){
                            new_data_total = new_data_total + newdata[i]['value'];
                            na = get_natave(newdata[i]['label'], chart_name, year);
                            new_na_data.push({
                                'value': parseFloat(na.slice(0, na.length - 1)) / 100,
                                'label': newdata[i]['label']
                                });
                        }

                        for (var i = 0; i < new_na_data.length; i++){
                            new_na_data[i]['value'] = Math.round(new_na_data[i]['value'] * new_data_total, 0)
                        }

                        yMaxA = d3.max(newdata, function(d) {
                            return d.value;
                        });

                        yMaxB = d3.max(new_na_data, function(d) {
                            return d.value;
                        });

                        if (yMaxA > yMaxB){
                            yMax = yMaxA
                        } else {
                            yMax = yMaxB
                        }

                        y.domain([0, yMax]);

                        line.y(function(d) { return y(d.value); });

                        svg.select(".line")
                          .datum(new_na_data)
                          .transition()
                            .duration(1000)
                            .ease(d3.easeLinear)
                            .attr("d", line);

                        var bars = svg.selectAll(".bar").data(newdata);

                        bars.transition()
                            .duration(2000)
                            .attr("transform", function (d) {
                                return "translate" + "(" + x(d.label) +
                                    "," + (y(d.value)) + ")";
                            });

                        bars.select("rect")
                            .transition()
                            .duration(2000)
                            .attr("height", function (d) {
                                return h - margin.bottom - y(d.value);
                            });

                        svg.select(".r.y.axis")
                            .transition()
                            .duration(2000)
                            .call(yAxis);
                    }
                });
            }

            segcon = {
                'two': 'sc-2-21',
                'three': 'sc-2-31',
                'four': 'sc-2-41',
                'five': 'sc-2-51',
                'six': 'sc-2-61',
                'seven': 'sc-2-71',
                'eight': 'sc-2-81',
                'nine': 'sc-2-91',
                'ten': 'sc-2-101',
                'eleven': 'sc-2-111',
                'twelve': 'sc-2-121',
                'thirteen': 'sc-2-131',
                'fourteen': 'sc-2-141',
                'fifteen': 'sc-2-151',
                'sixteen': 'sc-2-161',
                'seventeen': 'sc-2-171',
                'eighteen': 'sc-2-181'
            };

            segcont = {
                'two': 'sc2',
                'three': 'sc3',
                'four': 'sc4',
                'five': 'sc5',
                'six': 'sc6',
                'seven': 'sc7',
                'eight': 'sc8',
                'nine': 'sc9',
                'ten': 'sc10',
                'eleven': 'sc11',
                'twelve': 'sc12',
                'thirteen': 'sc13',
                'fourteen': 'sc14',
                'fifteen': 'sc15',
                'sixteen': 'sc16',
                'seventeen': 'sc17',
                'eighteen': 'sc18'
            };

            if (chart_name == 'one'){
                seg_control = 'sc-2-1';
                if ($("#sc0 input[type='radio']:checked")[0].labels == null){
                    var selector = document.getElementsByName('sc-0');
                    for(var i = 0; i < selector.length; i++) {
                        //Check if button is checked
                        var button = selector[i];
                        if(button.checked) {
                            //Return value
                            id = button.id;
                        }
                    }

                    if (id.slice(id.length - 1) == 1){
                        agg = 'Pie';
                    } else if (id.slice(id.length - 1) == 2){
                        agg = 'Bar'
                    } else if (id.slice(id.length - 1) == 3){
                        agg = 'Forest'
                    }

                } else {
                    // Chrome
                    agg = $("#sc0 input[type='radio']:checked")[0].labels[0].innerHTML;
                }
            } else {
                seg_control = segcon[chart_name];
            }

            d3.select("#" + seg_control + "-1")
                .on("click", function() {

                    if (chart_name == 'one') {
                        if ($("#sc0 input[type='radio']:checked")[0].labels == null){
                            var selector = document.getElementsByName('sc-0');
                            for(var i = 0; i < selector.length; i++) {
                                //Check if button is checked
                                var button = selector[i];
                                if(button.checked) {
                                    //Return value
                                    id = button.id;
                                }
                            }

                            if (id.slice(id.length - 1) == 1){
                                agg = 'Pie';
                            } else if (id.slice(id.length - 1) == 2){
                                agg = 'Bar'
                            } else if (id.slice(id.length - 1) == 3){
                                agg = 'Forest'
                            }

                        } else {
                            // Chrome
                            agg = $("#sc0 input[type='radio']:checked")[0].labels[0].innerHTML;
                        }
                        seg_id = 'sc1';
                    } else {
                        if ($("#" + segcont[chart_name] + " input[type='radio']:checked")[0].labels == null){
                            var selector = document.getElementsByName(segcont[chart_name]);
                            for(var i = 0; i < selector.length; i++) {
                                //Check if button is checked
                                var button = selector[i];
                                if(button.checked) {
                                    //Return value
                                    id = button.id;
                                }
                            }

                            if (id.slice(id.length - 1) == 1){
                                agg = 'Pie';
                            } else {
                                agg = 'Bar'
                            }

                        } else {
                            // Chrome
                            agg = $("#" + segcont[chart_name] + " input[type='radio']:checked")[0].labels[0].innerHTML;
                        }
                        seg_id = this.name.replace('-','')
                    }

                    if (agg = "Bar"){
                        ajax_get_bar(2011)
                    }
                });
            d3.select("#" + seg_control + "-2")
                .on("click", function() {
                    if (chart_name == 'one') {
                        if ($("#sc0 input[type='radio']:checked")[0].labels == null){
                            var selector = document.getElementsByName('sc-0');
                            for(var i = 0; i < selector.length; i++) {
                                //Check if button is checked
                                var button = selector[i];
                                if(button.checked) {
                                    //Return value
                                    id = button.id;
                                }
                            }

                            if (id.slice(id.length - 1) == 1){
                                agg = 'Pie';
                            } else if (id.slice(id.length - 1) == 2){
                                agg = 'Bar'
                            } else if (id.slice(id.length - 1) == 3){
                                agg = 'Forest'
                            }

                        } else {
                            // Chrome
                            agg = $("#sc0 input[type='radio']:checked")[0].labels[0].innerHTML;
                        }
                        seg_id = 'sc1';
                    } else {
                        if ($("#" + segcont[chart_name] + " input[type='radio']:checked")[0].labels == null){
                            var selector = document.getElementsByName(segcont[chart_name]);
                            for(var i = 0; i < selector.length; i++) {
                                //Check if button is checked
                                var button = selector[i];
                                if(button.checked) {
                                    //Return value
                                    id = button.id;
                                }
                            }

                            if (id.slice(id.length - 1) == 1){
                                agg = 'Pie';
                            } else {
                                agg = 'Bar'
                            }

                        } else {
                            // Chrome
                            agg = $("#" + segcont[chart_name] + " input[type='radio']:checked")[0].labels[0].innerHTML;
                        }
                        seg_id = this.name.replace('-','')
                    }

                    if (agg = "Bar"){
                        ajax_get_bar(2016)
                    }
                });
        }

        function chart_effect(id, data, chart_name, before_top, after_top, desc, title){
            drawPieChart(data, chart_name, before_top, after_top, desc, title);
            $('#' + id + '-1')
            .click(function () {
                $("#chart-" + chart_name).fadeOut(function () {
                    $(this).children().remove();
                    document.getElementById(id + '1-2').checked = true;
                    drawPieChart(data, chart_name, before_top, after_top, desc, title);
                    $(this).fadeIn();
                });
            });
            $('#' + id + '-2')
            .click(function () {
                $("#chart-" + chart_name).fadeOut(function () {
                    $(this).children().remove();
                    document.getElementById(id + '1-2').checked = true;
                    if (chart_name == 'two'){
                        drawBarChart(brel_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'three'){
                        drawBarChart(bnat_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'four'){
                        drawBarChart(bchild_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'five'){
                        drawBarChart(bfam_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'six'){
                        drawBarChart(bhh_size_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'seven'){
                        drawBarChart(bhouse_type_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'eight'){
                        drawBarChart(bhouse_age_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'nine'){
                        drawBarChart(bhh_occupancy_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'ten'){
                        drawBarChart(bhh_rooms_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'eleven'){
                        drawBarChart(bhh_occupation_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'twelve'){
                        drawBarChart(bprince_stat_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'thirteen'){
                        drawBarChart(bsocclass_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'fourteen'){
                        drawBarChart(beducation_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'fifteen'){
                        drawBarChart(btransport_method_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'sixteen'){
                        drawBarChart(btransport_time_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'seventeen'){
                        drawBarChart(boccupation_profile, chart_name, before_top, after_top, desc, title);
                    } else if (chart_name == 'eighteen'){
                        drawBarChart(bindustry_profile, chart_name, before_top, after_top, desc, title);
                    }
                    $(this).fadeIn();
                });
            });
        }

        function get_na(label, data){
            for (var i = 0; i < data.length; i++){
                if (data[i].label == label){
                    return data[i].value;
                }
            }
        }

        function drawXmasChart(l_data, r_data, ls_data, rs_data, chart_name, before_top, after_top, title) {
            margin = {top: 44, right: 70, bottom: 44, left: 25};

            w = width;

            var container = d3.select("div#" + chart_name + "-cont")
                .style("width",w);

            var svg = d3.select("svg#chart-" + chart_name + "")
                .attr("viewBox", "0 0 " + w + " " + height);

            window.onresize = resized(svg, container);

            var midpoint = (w) / 2;

            var xScale = d3.scaleLinear()
                .domain([0, d3.max(r_data, function(d) {
                    return d.value;
                })])
                .range([0, midpoint - margin.right]);

            var zScale = d3.scaleLinear()
                .domain([d3.max(l_data, function(d) {
                    return d.value;
                }),0])
                .range([margin.left, midpoint]);

            var x = d3.axisBottom()
                      .scale(xScale)
                      .ticks(5)
                      .tickFormat(function (d) {
                           return d + '%'
                       });

            var z = d3.axisBottom()
                      .scale(zScale)
                      .ticks(5)
                      .tickFormat(function (d) {
                           return d + '%'
                       });

            var xs = d3.scaleLinear()
                .rangeRound([0, midpoint - margin.right]);

            var zs = d3.scaleLinear()
                .rangeRound([0, midpoint - margin.left]);

            var y = d3.scaleBand()
                      .range([height - margin.top, margin.bottom])
                      .padding(0.2);

            var rline = d3.line()
                .x(function(d) { return xs(d.value); })
                .y(function(d) { return y(d.label); });

            var lline = d3.line()
                .x(function(d) { return zs(d.value); })
                .y(function(d) { return y(d.label); });

            xs.domain([0, d3.max(r_data, function(d) {
                return d.value;
            })]);

            zs.domain([d3.max(l_data, function(d) {
                return d.value;
            }), 0]);

            y.domain(r_data.map(function(d) {
                return d.label;
            }));

            svg.append("path")
              .datum(rs_data)
              .attr("fill", "none")
              .attr("stroke", "#008000")
              .attr("stroke-linejoin", "round")
              .attr("stroke-linecap", "round")
              .attr("stroke-width", 2)
              .attr("d", rline)
              .attr("transform", "translate(" + midpoint + ", " + y.bandwidth() / 2 + ")");

            svg.append("path")
              .datum(ls_data)
              .attr("fill", "none")
              .attr("data-legend", 'National Average')
              .attr("stroke", "#008000")
              .attr("stroke-linejoin", "round")
              .attr("stroke-linecap", "round")
              .attr("stroke-width", 2)
              .attr("d", lline)
              .attr("transform", "translate(" + margin.left + ", " + y.bandwidth() / 2 + ")");

            var div = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);

            svg.selectAll(".rbar")
                .data(r_data)
              .enter()
                .append("rect")
                .attr("class", "rbar")
                .attr("y", function(d) {
                  return y(d.label);
                })
                .attr("height", y.bandwidth())
                .attr('x', midpoint)
                .attr("width", function(d) {
                  return xScale(d.value);
                })
                .style("fill", "#05084E")
                .style("opacity", .65)
                .on("mouseover", function(d) {
                    d3.select(this)
                        .style('opacity', 1)
                        .attr('r', 3)
                        .style("fill", "#B32650");
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);

                        div.html(before_top + ": " + d.label + " " + after_top +
                            "<br>Percentage: " + d.value + '%' +
                            "<br>National Average: " + get_na(d.label, rs_data) + '%'
                            )
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");

                })
                .on("mouseout", function(d) {
                    d3.select(this)
                        .style('opacity', 0.65)
                        .attr('r', 2)
                        .style("fill", "#05084E");
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            svg.selectAll(".lbar")
                .data(l_data)
              .enter()
                .append("rect")
                .attr("class", "lbar")
                .attr("y", function(d) {
                  return y(d.label);
                })
                .attr("height", y.bandwidth())
                .attr('x', function(d){
                    return zScale(d.value);
                })
                .attr("width", function(d) {
                  return midpoint - zScale(d.value);
                })
                .style("fill", "#B32650")
                .style("opacity", .65)
                .on("mouseover", function(d) {
                    d3.select(this)
                        .style('opacity', 1)
                        .attr('r', 3)
                        .style("fill", "#05084E");
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);

                        div.html(before_top + ": " + d.label + " " + after_top +
                            "<br>Percentage: " + d.value + '%' +
                            "<br>National Average: " + get_na(d.label, ls_data)
                            )
                            .style("left", (d3.event.pageX) - 145 + "px")
                            .style("top", (d3.event.pageY - 28) + "px");

                })
                .on("mouseout", function(d) {
                    d3.select(this)
                        .style('opacity', 0.65)
                        .attr('r', 2)
                        .style("fill", "#B32650");
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            svg.append("g")
               .attr("transform", "translate(" + midpoint + "," + (height - margin.top) + ")")
               .call(x)
            .selectAll("text")
               .attr("y", 6)
               .attr("x", 3)
               .attr("transform", "rotate(45)")
               .style("text-anchor", "start");

            svg.append("g")
               .attr("transform", "translate(0," + (height - margin.top) + ")")
               .call(z)
            .selectAll("text")
               .attr("y", 6)
               .attr("x", 3)
               .attr("transform", "rotate(45)")
               .style("text-anchor", "start");

            // add the y Axis
            svg.append("g")
                .call(d3.axisLeft(y))
                .attr("transform", "translate(" + midpoint + ",0)");

            svg.append("text")
               .attr("transform", "rotate(-90)")
               .attr("y", 0)
               .attr("x", 0 - (height / 2))
               .attr("dy", "1em")
               .style("text-anchor", "middle")
               .text("Female Age Distribution")
               .style("font-size","0.8em");

            svg.append("text")
               .attr("transform", "rotate(-90)")
               .attr("y", w - margin.right + 4)
               .attr("x", 0 - (height / 2))
               .attr("dy", "1em")
               .style("text-anchor", "middle")
               .text("Male Age Distribution")
               .style("font-size","0.8em");

            svg.append("g")
                .attr("class", "grid")
                .attr("transform", "translate(" + (w / 2) + "," + (height - margin.top) + ")")
                .attr('opacity', 0.3)
                .call(x
                  .tickSize(-height + margin.bottom + margin.top)
                  .tickFormat("")
                  .tickSizeOuter(0)
                );

            svg.append("g")
                .attr("class", "grid")
                .attr("transform", "translate(0," + (height - margin.top)  + ")")
                .attr('opacity', 0.3)
                .call(z
                  .tickSize(-height + margin.bottom + margin.top)
                  .tickFormat("")
                  .tickSizeOuter(0)
                );


            var circle = d3.symbol().type(d3.symbolCircle).size(60)();

            var symbolScale =  d3.scaleOrdinal()
              .domain(['National Average'])
              .range([circle]);

            svg.append("g")
              .attr("class", "legendSymbol")
              .attr("transform", "translate(" + (w - 160) + "," + (height - 10) + ")");


            var legendPath = d3.legendSymbol()
              .scale(symbolScale)
              .orient("vertical")
              .labelWrap(100);

            if ($("#sc0 input[type='radio']:checked")[0].labels == null){
                //Firefox

            } else {
                //Chrome
                svg.select(".legendSymbol")
                    .call(legendPath)
                    .style('font-size', '1em')
                    .style('font-weight', 'normal');
            }

            svg.select('.swatch')
                .style('fill', '#008000')
                .attr("transform", "translate(2, 0)");

            svg.selectAll("text")
                .style("font-size","1.2em")
                .style("font-family", "Raleway")
                .style('font-width', 'normal');
                //.style('fill', 'white');

            svg.append("text")
                .attr("transform", "translate(" + (w / 2) + " , 0)")
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text(title)
                .style("font-size","1.6em");
        }

        window.onload = function(){

            $('#demographics').after(
                "<div id='newFooter'>" +
                    "<a href='/'>" +
                        "<p>Property Price Explorer</p>" +
                    "</a>" +
                    "<div class='fsep'>|</div>" +
                    "<a href='/table'>" +
                        "<p>View Properties</p>" +
                    "</a>" +
                    "<div class='fsep'>|</div>" +
                    "<a href='/reporter'>" +
                        "<p>Demographic & Price History Reports</p>" +
                    "</a>" +
                    "<div class='fsep'>|</div>" +
                    "<a href='/hp-predictor'>" +
                        "<p>House Price Prediction</p>" +
                    "</a>" +
                    "<div class='fsep'>|</div>" +
                    "<a href='/risk'>" +
                        "<p>Mortgage Risk Dashboard</p>" +
                    "</a>" +
                    "<div class='fsep'>|</div>" +
                    "<a href='/our-data'>" +
                        "<p>Our Data</p>" +
                    "</a>" +
                    "<div class='fsep'>|</div>" +
                    "<a href='/privacy-cookies'>" +
                        "<p>Privacy & Data Collection</p>" +
                    "</a>" +
                    "<div class='fsep'>|</div>" +
                    "<a href='/contact'>" +
                        "<p>Contact</p>" +
                    "</a>" +
                "</div>"
            );

            $('#filter-options').click(function(){
                display = $('.panel').css('maxHeight');
                if (display == '0px'){
                    $('i').removeClass('fa-arrow-circle-right');
                    $('i').addClass('fa-arrow-circle-down');
                    $('.panel')
                        .css('minHeight', '710px')
                        .css('height', '710px')
                        .css('maxHeight', '710px');
                    $('#options').css('flex', '0 0 760px');
                } else {
                    $('i').removeClass('fa-arrow-circle-down');
                    $('i').addClass('fa-arrow-circle-right');
                    $('.panel')
                        .css('height', '0px')
                        .css('minHeight', '0px')
                        .css('maxHeight', '0px');
                    $('#options').css('flex', '0 0 50px');
                }
            });

            var lu = '{{ last_update }}';

            d = lu.slice(0, 2);
            m = lu.slice(3, 5);
            y = lu.slice(6, 10);

            start_date = new Date(2010, 0).getTime();

            end_date = new Date(y, m).getTime();

            max_p = {{ maxp }};

            drawTimeSlider();
            drawPriceSlider();
            drawMap();

            google.maps.event.addListener(gmap, 'dragend', function () {
                showZone();
            });

            google.maps.event.addListener(gmap, 'zoom_changed', function () {
                showZone();
            });

            ca = Cookies.get('areaMain');

            $('#aoi-stats-left')
                .append(function(){
                    if (ca == 'map'){
                        return '<p>Map Bounds (Latitide):</p>'
                    } else if (ca == 'radius'){
                        return '<p>Circle centered at:'
                    }
                })
                .append(function(){
                    if (ca == 'map'){
                        return '<p>Map Bounds (Longitude):</p>'
                    }
                })
                .append(function(){
                    if (ca == 'map' || ca == 'radius'){
                        return '<p>Primary Electoral District:</p><p>Number of Electoral Districts in Area:</p>'
                    }
                })
                .append('<p>Price Range:</p>')
                .append('<p>Date Range:</p>')
                .append(function(){
                    if (ca == 'county' || ca == 'region' || ca == 'country'){
                        return '<p>Unmappable Data Included?</p>';
                    }
                });

            pmax = Cookies.get('max_price');
            pmin = Cookies.get('min_price');
            dmax = new Date(Cookies.get('max_date') * 1);
            dmin = new Date(Cookies.get('min_date') * 1);

            $('#aoi-stats-right')
                .append(function(){
                    if (ca == 'map'){
                        return '<p>Rectangle bounded by coordinates below.</p>'
                    } else if (ca == 'radius'){
                        r = Cookies.get('radius');
                        return '<p>Circle of ' + r + 'km around centroid below.</p>'
                    } else if (ca == 'county'){
                        c = Cookies.get('areaSecond');
                        return '<p>Co. ' + c + '</p>'
                    } else if (ca == 'region'){
                        r = Cookies.get('areaSecond');
                        return '<p>' + r + '</p>'
                    } else {
                        return '<p>The Republic of Ireland</p>'
                    }
                })
                .append(function(){
                    if (ca == 'map'){
                        return '<p>' + to_dms(Cookies.get('bottom')) + ' N - ' + to_dms(Cookies.get('top')) + ' N</p>'
                    } else if (ca == 'radius'){
                        return '<p>' + to_dms(parseFloat((Cookies.get('top')) - parseFloat(Cookies.get('bottom')))/2 + parseFloat(Cookies.get('bottom'))) + ' N, ' +
                            to_dms(parseFloat((Cookies.get('right')) - parseFloat(Cookies.get('left')))/2 + parseFloat(Cookies.get('left'))) + ' W</p>'
                    }
                })
                .append(function(){
                    if (ca == 'map'){
                        return '<p>' + to_dms(Cookies.get('right')) + ' W - ' + to_dms(Cookies.get('left')) + ' W</p>'
                    }
                })
                .append(function(){
                    if (ca == 'map' || ca == 'radius'){
                         return '<p>{{ dom_ed }}</p><p>{{ n_ed }}</p>'
                    }
                })
                .append('<p>&euro;' + thousandsDisplay(pmin) + ' - ' + '&euro;' + thousandsDisplay(pmax) + '</p>')
                .append('<p>' + monthNames[dmin.getUTCMonth()] + ' ' + dmin.getUTCFullYear() + ' - ' +
                        monthNames[dmax.getUTCMonth()] + ' ' + dmax.getUTCFullYear() + '</p>')
                .append(function(){
                    if (ca == 'county' || ca == 'region' || ca == 'country'){
                        if (Cookies.get('bad_data_inc') == 'true'){
                            return '<p>Yes</p>'
                        } else {
                            return '<p>No</p>'
                        }
                    }
                });

            {% if enoughdata == 'true' %}

                for (var i = 0; i < current_points.length; i++){

                        var circle = L.circle(current_points[i], {
                            fillColor: '#05084E',
                            weight: 2,
                            opacity: 0.6,
                            color: '#05084E',
                            dashArray: null,
                            fillOpacity: 0.6,
                            radius: 15
                        }).addTo(map);
                    }

                $('#sales-stats-right')
                    .append('<p>&euro;' + thousandsDisplay({{ avg_price }}) + '</p>')
                    .append('<p>&euro;' + thousandsDisplay({{ med_price }}) + '</p>')
                    .append('<p>' + thousandsDisplay({{ volume }}) + '</p>')
                    .append('<p>&euro;' + thousandsDisplay({{ max_price }}) + '</p>')
                    .append('<p>&euro;' + thousandsDisplay({{ min_price }}) + '</p>');

                drawScatterPlot(sales_data, 's-one', 'Price ()', 'Sales History', ' ', 'Average Price: ', 'sc-7-1', price_lobf_coef);
                drawScatterPlot(volume_data, 's-two', 'Sales Volume', 'Sales Volume', '', 'Number of Sales: ', 'sc-7-2', vol_lobf_coef);
                drawScatterSeries(new_data, 's-three', 'Sales Volume', 'New vs 2nd Hand Property Sales Volume', '', 'Number of Sales: ', 'sc-7-3');
                drawHistogram(hist_data, 's-four');

                drawPieChart(age_profile, 'one', 'Age', 'years', 'Population', 'Age Distribution (Years)');
                $('#sc-3-1-1')
                    .click(function () {
                        $("#chart-one").fadeOut(function() {
                            $(this).children().remove();
                            drawPieChart(age_profile, 'one', 'Age', 'years', 'Population', 'Age Distribution (Years)');
                            $(this).fadeIn();
                        });
                        $('#sc-2-1-1').prop("disabled", false);
                        $('#sc-2-1-2').prop("disabled", false);
                    });
                $('#sc-3-1-2')
                    .click(function () {
                        $("#chart-one").fadeOut(function () {
                            $(this).children().remove();
                            drawBarChart(bage_profile, 'one', 'Age', 'years', 'Population', 'Age Distribution (Years)');
                            $(this).fadeIn();
                        });
                        $('#sc-2-1-1').prop("disabled", false);
                        $('#sc-2-1-2').prop("disabled", false);
                    });
                $('#sc-3-1-3')
                    .click(function () {
                        $("#chart-one").fadeOut(function() {
                            $(this).children().remove();
                            drawXmasChart(age_females, age_males, age_na_females, age_na_males, 'one', 'Age', 'years', 'Population Age Distribution');
                            $(this).fadeIn();
                        });

                        $('#sc-2-1-1').prop("disabled", true);
                        $('#sc-2-1-2').prop("disabled", true);
                    });

                chart_effect('sc-2-2', rel_profile, 'two', 'Relationship Status', '', 'Population', 'Relationship Status');
                chart_effect('sc-2-3', nat_profile, 'three', 'Nationality', '', 'Population', 'Nationality');
                chart_effect('sc-2-4', child_profile, 'four', 'Children', '', 'Families', 'Number of Children per Family');
                chart_effect('sc-2-5', fam_profile, 'five', 'Family Status', '', 'Families', 'Family Status');
                chart_effect('sc-2-6', hh_size_profile, 'six', 'People per Household:', '', 'Households', 'Number of People per Household');
                chart_effect('sc-2-7', house_type_profile, 'seven', 'House Type', '', 'Population', 'House Type');
                chart_effect('sc-2-8', house_age_profile, 'eight', 'Year of Construction', '', 'Houses', 'House Age');
                chart_effect('sc-2-9', hh_occupancy_profile, 'nine', 'Inhabitant Type', '', 'Households', 'Inhabitant Status');
                chart_effect('sc-2-10', hh_rooms_profile, 'ten', 'Rooms', '', 'Households', 'Rooms per House');
                chart_effect('sc-2-11', hh_occupation_profile, 'eleven', 'Occupancy Status', '', 'Households', 'Occupancy Status');
                chart_effect('sc-2-12', prince_stat_profile, 'twelve', 'Employment Status', '', 'Population', 'Employment Status');
                chart_effect('sc-2-13', socclass_profile, 'thirteen', 'Employment Type', '', 'Population', 'Employment Type');
                chart_effect('sc-2-14', education_profile, 'fourteen', 'Education Level', '', 'Population', 'Highest Education Achieved');
                chart_effect('sc-2-15', transport_method_profile, 'fifteen', 'Transport Method', '', 'Population', 'Transport to Work Method');
                chart_effect('sc-2-16', transport_time_profile, 'sixteen', 'Transport Time', '', 'Population', 'Transport to Work Time');
                chart_effect('sc-2-17', occupation_profile, 'seventeen', 'Occupation', '', 'Population', 'Occupation');
                chart_effect('sc-2-18', industry_profile, 'eighteen', 'Industry', '', 'Population', 'Industry Profile');
            {% endif %}
        };

    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCXosjHZchd8S-A7xEes69FhCX18rqJHUw&callback=initMap"></script>

{% endblock %}